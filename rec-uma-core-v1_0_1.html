<!DOCTYPE html><html lang="en"><head profile="http://dublincore.org/documents/2008/08/04/dc-html/"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>User-Managed Access (UMA) Profile of OAuth
    2.0</title><style type="text/css" title="Xml2Rfc (sans serif)">
a {
  text-decoration: none;
}
a.smpl {
  color: black;
}
a:hover {
  text-decoration: underline;
}
a:active {
  text-decoration: underline;
}
address {
  margin-top: 1em;
  margin-left: 2em;
  font-style: normal;
}
body {
  color: black;
  font-family: cambria, georgia, serif;
  font-size: 12pt;
  margin: 2em auto;
  max-width: 1000px;
}
samp, tt, code, pre {
  font-family: consolas, monaco, monospace;
}
cite {
  font-style: normal;
}
dl {
  margin-left: 2em;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: .0em;
}
dl > dd > dl {
  margin-top: 0.5em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}
dl p {
  margin-left: 0em;
}
h1 {
  color: green;
  font-size: 150%;
  line-height: 18pt;
  font-weight: bold;
  text-align: center;
  margin-top: 36pt;
  margin-bottom: 0pt;
}
h1.kantara {
  margin-top: 12pt;
  margin-bottom: 12pt;
}
h2 {
  font-size: 130%;
  line-height: 21pt;
  page-break-after: avoid;
}
h2.np {
  page-break-before: always;
}
h3 {
  font-size: 120%;
  line-height: 15pt;
  page-break-after: avoid;
}
h4 {
  font-size: 110%;
  page-break-after: avoid;
}
h5, h6 {
  page-break-after: avoid;
}
h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
  color: black;
}
img {
  margin-left: 3em;
}
img.kantara {
  margin-left: 0;
  max-width:250px;
  max-height:100px;
}
li {
  margin-left: 2em;
}
ol {
  margin-left: 2em;
}
ol.la {
  list-style-type: lower-alpha;
}
ol.ua {
  list-style-type: upper-alpha;
}
ol p {
  margin-left: 0em;
}
p {
  margin-left: 2em;
}
pre {
  font-size: 11pt;
  margin-left: 3em;
  background-color: lightyellow;
  padding: .25em;
  page-break-inside: avoid;
}
pre.text2 {
  border-style: dotted;
  border-width: 1px;
  background-color: #f0f0f0;
}
pre.inline {
  background-color: white;
  padding: 0em;
  page-break-inside: auto;
}
pre.text {
  border-style: dotted;
  border-width: 1px;
  background-color: #f8f8f8;
}
pre.drawing {
  border-style: solid;
  border-width: 1px;
  background-color: #f8f8f8;
  padding: 2em;
}
table {
  margin-left: 2em;
}
table.header {
  border-spacing: 1px;
  width: 95%;
  font-size: 11pt;
  color: white;
}
td.top {
  vertical-align: top;
}
td.topnowrap {
  vertical-align: top;
  white-space: nowrap;
}
table.header td {
  background-color: gray;
  width: 50%;
}
table.header a {
  color: white;
}
table.kantara {
  color: black;
}
table.header td.kantara {
  background-color:white;
}
td.reference {
  vertical-align: top;
  white-space: nowrap;
  padding-right: 1em;
}
thead {
  display:table-header-group;
}
ul.toc, ul.toc ul {
  list-style: none;
  margin-left: 1.5em;
  padding-left: 0em;
}
ul.toc li {
  line-height: 150%;
  font-weight: bold;
  margin-left: 0em;
}
ul.toc li li {
  line-height: normal;
  font-weight: normal;
  font-size: 11pt;
  margin-left: 0em;
}
li.excluded {
  font-size: 0pt;
}
ul p {
  margin-left: 0em;
}
.filename, h1, h2, h3, h4 {
  font-family: candara, calibri, segoe, optima, arial, sans-serif;
}

.comment {
  background-color: yellow;
}
.center {
  text-align: center;
}
.error {
  color: red;
  font-style: italic;
  font-weight: bold;
}
.figure {
  font-weight: bold;
  text-align: center;
  font-size: 10pt;
}
.filename {
  color: #333333;
  font-size: 112%;
  font-weight: bold;
  line-height: 21pt;
  text-align: center;
  margin-top: 0pt;
}
.fn {
  font-weight: bold;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.warning {
  font-size: 130%;
  background-color: yellow;
}

@media screen {
  pre.text, pre.text2 {
    width: 69em;
  }
}

@media print {
  .noprint {
    display: none;
  }

  a {
    color: black;
    text-decoration: none;
  }

  table.header {
    width: 90%;
  }

  td.header {
    width: 50%;
    color: black;
    background-color: white;
    vertical-align: top;
    font-size: 110%;
  }

  ul.toc a:last-child::after {
    content: leader('.') target-counter(attr(href), page);
  }

  ul.ind li li a {
    content: target-counter(attr(href), page);
  }

  pre {
    font-size: 10pt;
  }

  .print2col {
    column-count: 2;
    -moz-column-count: 2;
    column-fill: auto;
  }
}

@page {
  @top-left {
       content: "Internet-Draft";
  }
  @top-right {
       content: "December 2015";
  }
  @top-center {
       content: "UMA Core";
  }
  @bottom-left {
       content: "Hardjono, et al.";
  }
  @bottom-center {
       content: "Expires June 30, 2016";
  }
  @bottom-right {
       content: "[Page " counter(page) "]";
  }
}

@page:first {
    @top-left {
      content: normal;
    }
    @top-right {
      content: normal;
    }
    @top-center {
      content: normal;
    }
}
</style><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyright"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 Protecting a Resource" href="#rfc.section.2"><link rel="Chapter" title="3 Getting Authorization and Accessing a Resource" href="#rfc.section.3"><link rel="Chapter" title="4 Error Messages" href="#rfc.section.4"><link rel="Chapter" title="5 Profiles for API Extensibility" href="#rfc.section.5"><link rel="Chapter" title="6 Specifying Additional Profiles" href="#rfc.section.6"><link rel="Chapter" title="7 Security Considerations" href="#rfc.section.7"><link rel="Chapter" title="8 Privacy Considerations" href="#rfc.section.8"><link rel="Chapter" title="9 IANA Considerations" href="#rfc.section.9"><link rel="Chapter" title="10 Acknowledgments" href="#rfc.section.10"><link rel="Chapter" href="#rfc.section.11" title="11 References"><meta name="generator" content="http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.736, 2015/06/05 18:58:55, XSLT vendor: libxslt http://xmlsoft.org/XSLT/"><link rel="schema.dct" href="http://purl.org/dc/terms/"><meta name="dct.creator" content="Hardjono, T."><meta name="dct.creator" content="Maler, E."><meta name="dct.creator" content="Machulak, M."><meta name="dct.creator" content="Catalano, D."><meta name="dct.identifier" content="urn:ietf:id:draft-uma-core"><meta name="dct.issued" scheme="ISO8601" content="2015-12-28"><meta name="dct.abstract" content="User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policies."><meta name="description" content="User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policies."></head><body><img class="kantara" src="https://kantarainitiative.org/wp-content/uploads/2014/07/img1.png" alt="Kantara Initiative"><div id="rfc.title"><h1 class="kantara">User-Managed Access (UMA) Profile of OAuth 2.0</h1></div><p><table class="header kantara"><tbody><tr><td class="left kantara">Version:</td><td class="left kantara">1.0.1</td></tr><tr><td class="kantara" colspan="2"> </td></tr><tr><td class="left kantara">Date:</td><td class="left kantara">2015-12-28</td></tr><tr><td class="kantara" colspan="2"> </td></tr><tr><td class="left kantara">Editor:</td><td class="left kantara">Thomas Hardjono, MIT</td></tr><tr><td class="kantara" colspan="2"> </td></tr><tr><td class="left kantara">Contributors:</td><td class="left kantara">Eve Maler, ForgeRock</td></tr><tr><td class="left kantara"></td><td class="left kantara">Maciej Machulak, Synergetics</td></tr><tr><td class="left kantara"></td><td class="left kantara">Domenico Catalano, Oracle</td></tr></tbody></table></p><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><p>User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policies.</p><div id="rfc.status"><h2><a href="#rfc.status">Status of This Document</a></h2><p>This specification was developed by the <a href="https://kantarainitiative.org/confluence/display/uma/Home">User-Managed Access Work Group</a> and approved by the Membership of the Kantara Initiative as a Recommendation according to its <a href="https://kantarainitiative.org/confluence/download/attachments/2293776/KI+Operating+Procedures+_V1.1_+2009-10-10.pdf">Operating Procedures</a>.</p></div><div id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><p>Copyright (c) 2015 Kantara Initiative and the persons identified as the document authors. All rights reserved.</p><p>This document is subject to the <a href="https://kantarainitiative.org/confluence/download/attachments/2293776/Kantara%20Initiative%20IPR%20Policies%20_V1.1_.pdf?version=1&amp;modificationDate=1244488630000&amp;api=v2">Kantara IPR Policy - Option Patent &amp; Copyright: Reciprocal Royalty Free with Opt-Out to Reasonable And Non discriminatory (RAND)</a> (<a href="https://kantarainitiative.org/confluence/pages/viewpage.action?pageId=41025689">HTML version</a>).</p></div><hr class="noprint"><div id="rfc.toc"><h2 class="np"><a href="#rfc.toc">Table of Contents</a></h2><ul class="toc"><li><a href="#rfc.section.1">1.</a>   <a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1</a>   <a href="#rfc.section.1.1">Notational Conventions</a></li><li><a href="#rfc.section.1.2">1.2</a>   <a href="#terminology">Terminology</a></li><li><a href="#rfc.section.1.3">1.3</a>   <a href="#endpoint-discussion">Achieving Distributed Access Control</a><ul><li><a href="#rfc.section.1.3.1">1.3.1</a>   <a href="#protection-api">Protection API and Protection API Token</a></li><li><a href="#rfc.section.1.3.2">1.3.2</a>   <a href="#authorization-api">Authorization API and Authorization API Token</a></li><li><a href="#rfc.section.1.3.3">1.3.3</a>   <a href="#resource-api">Protected Resource Interface and Requesting Party Token</a></li><li><a href="#rfc.section.1.3.4">1.3.4</a>   <a href="#rfc.section.1.3.4">Time-to-Live Considerations</a></li></ul></li><li><a href="#rfc.section.1.4">1.4</a>   <a href="#am-endpoints">Authorization Server Configuration Data</a></li></ul></li><li><a href="#rfc.section.2">2.</a>   <a href="#protecting-a-resource">Protecting a Resource</a></li><li><a href="#rfc.section.3">3.</a>   <a href="#getting-authz-accessing-resource">Getting Authorization and Accessing a Resource</a><ul><li><a href="#rfc.section.3.1">3.1</a>   <a href="#client-attempts-access">Client Attempts Access to Protected Resource</a><ul><li><a href="#rfc.section.3.1.1">3.1.1</a>   <a href="#without-rpt">Client Request to Resource Server With No RPT</a></li><li><a href="#rfc.section.3.1.2">3.1.2</a>   <a href="#with-rpt">Client Request to Resource Server With RPT</a></li></ul></li><li><a href="#rfc.section.3.2">3.2</a>   <a href="#register-permission">Resource Server Registers Requested Permission With Authorization Server</a><ul><li><a href="#rfc.section.3.2.1">3.2.1</a>   <a href="#rfc.section.3.2.1">Resource Server Request to Permission Registration Endpoint</a></li><li><a href="#rfc.section.3.2.2">3.2.2</a>   <a href="#ticket-management">Permission Ticket Creation and Management</a></li><li><a href="#rfc.section.3.2.3">3.2.3</a>   <a href="#rfc.section.3.2.3">Authorization Server Response to Resource Server on Permission Registration Success</a></li><li><a href="#rfc.section.3.2.4">3.2.4</a>   <a href="#rfc.section.3.2.4">Authorization Server Response to Resource Server on Permission Registration Failure</a></li></ul></li><li><a href="#rfc.section.3.3">3.3</a>   <a href="#rfc.section.3.3">Resource Server Responds to Client</a><ul><li><a href="#rfc.section.3.3.1">3.3.1</a>   <a href="#permission-success-to-client">Resource Server Response to Client on Permission Registration Success</a></li><li><a href="#rfc.section.3.3.2">3.3.2</a>   <a href="#permission-failure-to-client">Resource Server Response to Client on Permission Registration Failure</a></li><li><a href="#rfc.section.3.3.3">3.3.3</a>   <a href="#give-access">Resource Server Response to Client on Sufficiency of Authorization</a></li></ul></li><li><a href="#rfc.section.3.4">3.4</a>   <a href="#check-rpt-status">Resource Server Determines RPT Status</a><ul><li><a href="#rfc.section.3.4.1">3.4.1</a>   <a href="#token-introspection">Token Introspection Process</a></li><li><a href="#rfc.section.3.4.2">3.4.2</a>   <a href="#uma-bearer-token-profile">RPT Profile: Bearer</a></li></ul></li><li><a href="#rfc.section.3.5">3.5</a>   <a href="#seek-authorization">Client Seeks Authorization for Access</a><ul><li><a href="#rfc.section.3.5.1">3.5.1</a>   <a href="#rfc.section.3.5.1">Client Request to Authorization Server for Authorization Data</a></li><li><a href="#rfc.section.3.5.2">3.5.2</a>   <a href="#authorization-assessment">Authorization Assessment Process</a></li><li><a href="#rfc.section.3.5.3">3.5.3</a>   <a href="#give-rpt">Authorization Server Response to Client on Authorization Success</a></li><li><a href="#rfc.section.3.5.4">3.5.4</a>   <a href="#authorization-failure">Authorization Server Response to Client on Authorization Failure</a></li></ul></li><li><a href="#rfc.section.3.6">3.6</a>   <a href="#need-info">Client Responds to Authorization Server's Request for Additional Information</a><ul><li><a href="#rfc.section.3.6.1">3.6.1</a>   <a href="#step-up">Client Redirects Requesting Party to Authorization Server for Authentication</a></li><li><a href="#rfc.section.3.6.2">3.6.2</a>   <a href="#claim-push">Client Pushes Claim Tokens to Authorization Server</a></li><li><a href="#rfc.section.3.6.3">3.6.3</a>   <a href="#claim-redirect">Client Redirects Requesting Party to Authorization Server for Claims-Gathering</a></li></ul></li></ul></li><li><a href="#rfc.section.4">4.</a>   <a href="#errors">Error Messages</a><ul><li><a href="#rfc.section.4.1">4.1</a>   <a href="#oauth-error-response">OAuth Error Responses</a></li><li><a href="#rfc.section.4.2">4.2</a>   <a href="#uma-error-response">UMA Error Responses</a></li></ul></li><li><a href="#rfc.section.5">5.</a>   <a href="#comms-profiles">Profiles for API Extensibility</a><ul><li><a href="#rfc.section.5.1">5.1</a>   <a href="#alt-prot-profile">Protection API Extensibility Profile</a></li><li><a href="#rfc.section.5.2">5.2</a>   <a href="#alt-authz-profile">Authorization API Extensibility Profile</a></li><li><a href="#rfc.section.5.3">5.3</a>   <a href="#alt-resource-profile">Resource Interface Extensibility Profile</a></li></ul></li><li><a href="#rfc.section.6">6.</a>   <a href="#profiles">Specifying Additional Profiles</a><ul><li><a href="#rfc.section.6.1">6.1</a>   <a href="#uma-profiles">Specifying Profiles of UMA</a></li><li><a href="#rfc.section.6.2">6.2</a>   <a href="#rpt-profiles">Specifying RPT Profiles</a></li><li><a href="#rfc.section.6.3">6.3</a>   <a href="#claim-profiles">Specifying Claim Token Format Profiles</a></li></ul></li><li><a href="#rfc.section.7">7.</a>   <a href="#sec-consid">Security Considerations</a><ul><li><a href="#rfc.section.7.1">7.1</a>   <a href="#redirect-threats">Requesting Party Redirection and Impersonation Threats</a></li><li><a href="#rfc.section.7.2">7.2</a>   <a href="#rfc.section.7.2">Client Authentication</a></li><li><a href="#rfc.section.7.3">7.3</a>   <a href="#rfc.section.7.3">JSON Usage</a></li><li><a href="#rfc.section.7.4">7.4</a>   <a href="#trust-considerations">Profiles and Trust Establishment</a><ul><li><a href="#rfc.section.7.4.1">7.4.1</a>   <a href="#trust-push">Requirements for Trust When Clients Push Claim Tokens</a></li></ul></li></ul></li><li><a href="#rfc.section.8">8.</a>   <a href="#priv-consid">Privacy Considerations</a><ul><li><a href="#rfc.section.8.1">8.1</a>   <a href="#rfc.section.8.1">Resource Set Information at the Authorization Server</a></li><li><a href="#rfc.section.8.2">8.2</a>   <a href="#rfc.section.8.2">Requesting Party Information at the Authorization Server</a></li><li><a href="#rfc.section.8.3">8.3</a>   <a href="#rfc.section.8.3">Profiles and Trust Establishment</a></li></ul></li><li><a href="#rfc.section.9">9.</a>   <a href="#IANA">IANA Considerations</a><ul><li><a href="#rfc.section.9.1">9.1</a>   <a href="#rfc.section.9.1">JSON Web Token Claims Registration</a><ul><li><a href="#rfc.section.9.1.1">9.1.1</a>   <a href="#rfc.section.9.1.1">Registry Contents</a></li></ul></li><li><a href="#rfc.section.9.2">9.2</a>   <a href="#rfc.section.9.2">OAuth Token Introspection Response Registration</a><ul><li><a href="#rfc.section.9.2.1">9.2.1</a>   <a href="#rfc.section.9.2.1">Registry Contents</a></li></ul></li><li><a href="#rfc.section.9.3">9.3</a>   <a href="#rfc.section.9.3">Well-Known URI Registration</a><ul><li><a href="#rfc.section.9.3.1">9.3.1</a>   <a href="#rfc.section.9.3.1">Registry Contents</a></li></ul></li></ul></li><li><a href="#rfc.section.10">10.</a>   <a href="#Acknowledgments">Acknowledgments</a></li><li><a href="#rfc.section.11">11.</a>   <a href="#rfc.references">References</a><ul><li><a href="#rfc.section.11.1">11.1</a>   <a href="#rfc.references.1">Normative References</a></li><li><a href="#rfc.section.11.2">11.2</a>   <a href="#rfc.references.2">Informative References</a></li></ul></li><li><a href="#rfc.authors">Authors' Addresses</a></li></ul></div><ul class="toc"><li>Figures
        <ul><li><a href="#rfc.figure.1">Figure 1</a></li></ul></li></ul><hr class="noprint"><div id="introduction"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a> <a href="#introduction">Introduction</a></h2><div id="rfc.section.1.p.1"><p>User-Managed Access (UMA) is a profile of OAuth 2.0 <a href="#RFC6749"><cite title="The OAuth 2.0 Authorization Framework">[RFC6749]</cite></a>. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policies. Resource owners configure authorization servers with access policies that serve as asynchronous authorization grants.</p></div><div id="rfc.section.1.p.2"><p>UMA serves numerous use cases where a resource owner uses a dedicated service to manage authorization for access to their resources, potentially even without the run-time presence of the resource owner. A typical example is the following: a web user (an end-user resource owner) can authorize a web or native app (a client) to gain one-time or ongoing access to a protected resource containing his home address stored at a "personal data store" service (a resource server), by telling the resource server to respect access entitlements issued by his chosen cloud-based authorization service (an authorization server). The requesting party operating the client might be the resource owner, where the app is run by an e-commerce company that needs to know where to ship a purchased item, or the requesting party might be resource owner's friend who is using an online address book service to collect contact information, or the requesting party might be a survey company that uses an autonomous web service to compile population demographics. A variety of use cases can be found in <a href="#UMA-usecases"><cite title="UMA Scenarios and Use Cases">[UMA-usecases]</cite></a> and <a href="#UMA-casestudies"><cite title="UMA Case Studies">[UMA-casestudies]</cite></a>.</p></div><div id="rfc.section.1.p.3"><p>Practical control of access among loosely coupled parties requires more than just messaging protocols. This specification defines only the "technical contract" between UMA-conforming entities. Work is ongoing to define recommendations for developing agreements about the rights and responsibilities of parties operating and using these entities on a contractual or legal level (see, for example, <a href="#UMA-obligations"><cite title="Binding Obligations on UMA Participants">[UMA-obligations]</cite></a>). Parties operating entities that claim to be UMA-conforming should provide documentation of any rights and obligations between and among them; see <a href="#trust-considerations" title="Profiles and Trust Establishment">Section 7.4</a> for more information.</p></div><div id="rfc.section.1.p.4"><p>In enterprise settings, application access management sometimes involves letting back-office applications serve only as policy enforcement points (PEPs), depending entirely on access decisions coming from a central policy decision point (PDP) to govern the access they give to requesters. This separation eases auditing and allows policy administration to scale in several dimensions. UMA makes use of a separation similar to this, letting the resource owner serve as a policy administrator crafting authorization strategies for resources under their control.</p></div><div id="rfc.section.1.p.5"><p>In order to increase interoperable communication among the authorization server, resource server, and client, UMA leverages two purpose-built APIs related to the outsourcing of authorization, themselves protected by OAuth (or an OAuth-based authentication protocol) in embedded fashion.</p></div><div id="rfc.section.1.p.6"><p>The UMA protocol has three broad phases, as shown in <a href="#UMA-phases">Figure 1</a>.</p></div><div id="UMA-phases"></div><div id="rfc.figure.1"><p>The Three Phases of the UMA Profile of OAuth</p><pre>
                                           +--------------+
                                           |   resource   |
          +---------manage (A)------------ |     owner    |
          |                                +--------------+
          |         Phase 1:                      |
          |         protect a                control (C)
          |         resource                      |
          v                                       v
   +------------+               +----------+--------------+
   |            |               |protection|              |
   |  resource  |               |   API    | authorization|
   |   server   |&lt;-protect (B)--|  (needs  |    server    |
   |            |               |   PAT)   |              |
   +------------+               +----------+--------------+
   | protected  |                          | authorization|
   | resource   |                          |     API      |
   |(needs RPT) |                          |  (needs AAT) |
   +------------+                          +--------------+
          ^                                       |
          |         Phases 2 and 3:         authorize (D)
          |         get authorization,            |
          |         access a resource             v
          |                                +--------------+
          +---------access (E)-------------|    client    |
                                           +--------------+

                                           requesting party
</pre></div><p class="figure">Figure 1</p><div id="rfc.section.1.p.7"><p>The phases work as follows: </p><dl><dt>Protect a resource</dt><dd>(Described in <a href="#protecting-a-resource" title="Protecting a Resource">Section 2</a>.) The resource owner, who manages online resources at the resource server ("A"), introduces it to the authorization server so that the latter can begin protecting the resources. To accomplish this, the authorization server presents a protection API ("B") to the resource server. This API is protected by OAuth (or an OAuth-based authentication protocol) and requires a protection API token (PAT) for access. Out of band, the resource owner configures the authorization server with policies associated with the resource sets ("C") that the resource registers for protection.</dd><dt>Get authorization</dt><dd>(Described in <a href="#getting-authz-accessing-resource" title="Getting Authorization and Accessing a Resource">Section 3</a>.) The client approaches the resource server seeking access to an UMA-protected resource. In order to access it successfully, the client must first use the authorization server's authorization API ("D") to obtain authorization data and a requesting party token (RPT) on behalf of its requesting party, and the requesting party may need to undergo a process of trust elevation, for example, supplying identity claims. The API is protected by OAuth (or an OAuth-based authentication protocol) and requires an authorization API token (AAT) for access.</dd><dt>Access a resource</dt><dd>(Described in <a href="#getting-authz-accessing-resource" title="Getting Authorization and Accessing a Resource">Section 3</a>.) The client successfully presents to the resource server an RPT that has sufficient authorization data associated with it, gaining access to the desired resource ("E"). Phase 3 is effectively the "success path" embedded within phase 2.</dd></dl></div><div id="rfc.section.1.p.8"><p>Implementers have the opportunity to develop profiles (see <a href="#profiles" title="Specifying Additional Profiles">Section 6</a>) that specify and restrict various UMA protocol, RPT, and identity claim format options, according to deployment and usage conditions.</p></div><div><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1</a> Notational Conventions</h3><div id="rfc.section.1.1.p.1"><p>The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY', and 'OPTIONAL' in this document are to be interpreted as described in <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>.</p></div><div id="rfc.section.1.1.p.2"><p>Unless otherwise noted, all protocol properties and values are case sensitive. JSON <a href="#RFC7159"><cite title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC7159]</cite></a> data structures defined by this specification MAY contain extension properties that are not defined in this specification. Any entity receiving or retrieving a JSON data structure SHOULD ignore extension properties it is unable to understand. Extension names that are unprotected from collisions are outside the scope of this specification.</p></div></div><div id="terminology"><h3 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2</a> <a href="#terminology">Terminology</a></h3><div id="rfc.section.1.2.p.1"><p>UMA introduces the following new terms and enhancements of OAuth term definitions.</p><dl><dt>resource owner</dt><dd style="margin-left: 4.2em"><br>An OAuth resource owner that is the "user" in User-Managed Access. This is typically an end-user (a natural person) but it can also be a corporation or other legal person.</dd><dt>policy</dt><dd style="margin-left: 4.2em">The configuration parameters of an authorization server that effect resource access management. Authorization policies typically include elements similar to parts of speech; for example, "subjects" describe those seeking access (requesting parties and clients), "verbs" describe operational scopes of access, and "objects" describe targeted resource sets. Policy configuration takes place between the resource owner and the authorization server, and thus is out of scope for this specification.</dd><dt>requesting party</dt><dd style="margin-left: 4.2em"><br>An end-user, or a corporation or other legal person, that uses a client to seek access to a protected resource. The requesting party may or may not be the same party as the resource owner.</dd><dt>client</dt><dd style="margin-left: 4.2em"><br>An application making protected resource requests with the resource owner's authorization and on the requesting party's behalf.</dd><dt>claim</dt><dd style="margin-left: 4.2em"><br>A statement of the value or values of one or more identity attributes of a requesting party. A requesting party may need to provide claims to an authorization server in order to gain permission for access to a protected resource.</dd><dt>resource set</dt><dd style="margin-left: 4.2em">One or more protected resources that a resource server manages as a set, abstractly. In authorization policy terminology, a resource set is the "object" being protected. This term derives from <a href="#OAuth-resource-reg"><cite title="OAuth 2.0 Resource Set Registration">[OAuth-resource-reg]</cite></a>.</dd><dt>scope</dt><dd style="margin-left: 4.2em">A bounded extent of access that is possible to perform on a resource set. In authorization policy terminology, a scope is one of the potentially many "verbs" that can logically apply to a resource set ("object"). UMA associates scopes with labeled resource sets. This term derives from <a href="#OAuth-resource-reg"><cite title="OAuth 2.0 Resource Set Registration">[OAuth-resource-reg]</cite></a>.</dd><dt>token</dt><dd style="margin-left: 4.2em">A packaged collection of data meant to be transmitted to another entity. A token could be used for authorized access (an "access token"), or could be used to exchange information about a subject (a "claim token").</dd><dt>requesting party token (RPT)</dt><dd style="margin-left: 4.2em">An UMA access token associated with a set of authorization data, used by the client to gain access to protected resources at the resource server.</dd><dt>authorization data</dt><dd style="margin-left: 4.2em">Data associated with an RPT that enables some combination of the authorization server and resource server to determine the correct extent of access to allow to a client. Authorization data is a key part of the definition of an RPT profile.</dd><dt>authorization server</dt><dd style="margin-left: 4.2em"><br>A server that issues authorization data and RPTs to a client and protects resources managed at a resource server.</dd><dt>permission</dt><dd style="margin-left: 4.2em">A scope of access over a particular resource set at a particular resource server that is being requested by, or granted to, a requesting party. In authorization policy terminology, a permission is an entitlement that includes a "subject" (requesting party), "verbs" (one or more scopes of access), and an "object" (resource set). A permission is one example of authorization data.</dd><dt>permission ticket</dt><dd style="margin-left: 4.2em">A correlation handle that is conveyed from an authorization server to a resource server, from a resource server to a client, and ultimately from a client back to an authorization server, to enable the authorization server to assess the correct policies to apply to a request for authorization data.</dd><dt>authorization API token (AAT)</dt><dd style="margin-left: 4.2em">An OAuth access token with the scope <tt>uma_authorization</tt>, used by the client at the authorization API, consisting of the RPT endpoint.</dd><dt>RPT endpoint</dt><dd style="margin-left: 4.2em">An endpoint at the authorization server that issues RPTs and authorization data to the client.</dd><dt>protection API token (PAT)</dt><dd style="margin-left: 4.2em">An OAuth access token with the scope <tt>uma_protection</tt>, used by the resource server at the protection API, consisting of the resource set registration, permission registration, and token introspection endpoints.</dd><dt>resource set registration endpoint</dt><dd style="margin-left: 4.2em">An endpoint at the authorization server that allows the resource server to register resource sets.</dd><dt>permission registration endpoint</dt><dd style="margin-left: 4.2em">An endpoint at the authorization server that allows the resource server to request permission tickets.</dd><dt>token introspection endpoint</dt><dd style="margin-left: 4.2em">An endpoint at the authorization server that allows the resource server to query the status of an RPT and its associated authorization data.</dd></dl></div></div><div id="endpoint-discussion"><h3 id="rfc.section.1.3"><a href="#rfc.section.1.3">1.3</a> <a href="#endpoint-discussion">Achieving Distributed Access Control</a></h3><div id="rfc.section.1.3.p.1"><p>The software components that fill the roles of UMA authorization servers, resource servers, and clients respectively are intended to work in an interoperable fashion when each is operated by an independent party (for example, different organizations). For this reason, UMA specifies communications channels that the authorization server MUST implement as HTTP-based APIs that MUST use TLS and OAuth (or OAuth-based authentication protocol) protection, and that the resource server MUST implement as an HTTP-based interface. UMA's use of TLS is governed by <a href="#BCP195"><cite title="Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)">[BCP195]</cite></a>, which discusses deployment and adoption characteristics of different TLS versions.</p></div><div id="rfc.section.1.3.p.2"><p>For those OAuth protection use cases where an identity token is desired in addition to an access token, it is RECOMMENDED that an OAuth-based authentication protocol such as OpenID Connect <a href="#OIDCCore"><cite title="OpenID Connect Core 1.0 incorporating errata set 1">[OIDCCore]</cite></a> be used.</p></div><div id="rfc.section.1.3.p.3"><p>It is also REQUIRED, in turn, for resource servers and clients on the requesting side of UMA interactions to use these channels, unless a profile is being used that enables API extensibility. The profiles that enable such alternatives are provided in <a href="#comms-profiles" title="Profiles for API Extensibility">Section 5</a>.</p></div><div id="protection-api"><h4 id="rfc.section.1.3.1"><a href="#rfc.section.1.3.1">1.3.1</a> <a href="#protection-api">Protection API and Protection API Token</a></h4><div id="rfc.section.1.3.1.p.1"><p>The authorization server MUST present an HTTP-based protection API, protected by TLS and OAuth (or an OAuth-based authentication protocol), for use by resource servers. The authorization server thus has an OAuth token endpoint and authorization endpoint. The authorization server MUST declare all of its protection API endpoints in its configuration data (see <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a>).</p></div><div id="rfc.section.1.3.1.p.2"><p>The protection API consists of three endpoints:</p><ul><li>Resource set registration endpoint as defined by <a href="#OAuth-resource-reg"><cite title="OAuth 2.0 Resource Set Registration">[OAuth-resource-reg]</cite></a></li><li>Permission registration endpoint as defined by <a href="#register-permission" title="Resource Server Registers Requested Permission With Authorization Server">Section 3.2</a></li><li>Token introspection endpoint as defined by <a href="#RFC7662"><cite title="OAuth 2.0 Token Introspection">[RFC7662]</cite></a> and <a href="#token-introspection" title="Token Introspection Process">Section 3.4.1</a></li></ul></div><div id="rfc.section.1.3.1.p.3"><p>An entity seeking protection API access MUST have the scope <tt>uma_protection</tt>. An access token with at least this scope is called a protection API token (PAT) and an entity that can acquire an access token with this scope is by definition a resource server. A single entity can serve in both resource server and client roles if it has access tokens with the appropriate OAuth scopes. If a request to an endpoint fails due to an invalid, missing, or expired PAT, or requires higher privileges at this endpoint than provided by the PAT, the authorization server responds with an OAuth error.</p></div><div id="rfc.section.1.3.1.p.4"><p>The authorization server MUST support the OAuth bearer token profile for PAT issuance, and MAY support other OAuth token profiles. It MUST declare all supported token profiles and grant types for PAT issuance in its configuration data. Any OAuth authorization grant type might be appropriate depending on circumstances; for example, the client credentials grant is useful in the case of an organization acting as a resource owner. <a href="#UMA-Impl"><cite title="UMA Implementer's Guide">[UMA-Impl]</cite></a> discusses grant options further.</p></div><div id="rfc.section.1.3.1.p.5"><p>A PAT binds a resource owner, a resource server the owner uses for resource management, and an authorization server the owner uses for protection of resources at this resource server. It is not specific to any client or requesting party. The issuance of a PAT represents the approval of the resource owner for this resource server to use this authorization server for protecting some or all of the resources belonging to this resource owner.</p></div><div id="rfc.section.1.3.1.p.6"><p>Note: The PAT is used in registering a requested permission on a client's behalf (as described in <a href="#register-permission" title="Resource Server Registers Requested Permission With Authorization Server">Section 3.2</a>). One circumstance precipitating this action is when the client has attempted access without an RPT (as described in <a href="#without-rpt" title="Client Request to Resource Server With No RPT">Section 3.1.1</a>). In order for the resource server to know which authorization server to approach and which PAT (representing a resource owner) and resource set identifier to supply, the resource server's API needs be structured in such a way that it can derive this information from the client's RPT-free access attempt. In practice, this information likely needs to be passed through the URI, headers, or body of the client's request.</p></div></div><div id="authorization-api"><h4 id="rfc.section.1.3.2"><a href="#rfc.section.1.3.2">1.3.2</a> <a href="#authorization-api">Authorization API and Authorization API Token</a></h4><div id="rfc.section.1.3.2.p.1"><p>The authorization server MUST present an HTTP-based authorization API, protected by TLS and OAuth (or an OAuth-based authentication protocol), for use by clients. The authorization server thus has an OAuth token endpoint and authorization endpoint. The authorization server MUST declare its authorization API endpoint in its configuration data (see <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a>).</p></div><div id="rfc.section.1.3.2.p.2"><p>The authorization API consists of one endpoint:</p><ul><li>RPT endpoint as defined in <a href="#permission-success-to-client" title="Resource Server Response to Client on Permission Registration Success">Section 3.3.1</a></li></ul></div><div id="rfc.section.1.3.2.p.3"><p>An entity seeking authorization API access MUST have the scope <tt>uma_authorization</tt>. An access token with at least this scope is called an authorization API token (AAT) and an entity that can acquire an access token with this scope is by definition a client. A single entity can serve in both resource server and client roles if it has access tokens with the appropriate OAuth scopes. If a request to an endpoint fails due to an invalid, missing, or expired AAT, or requires higher privileges at this endpoint than provided by the AAT, the authorization server responds with an OAuth error.</p></div><div id="rfc.section.1.3.2.p.4"><p>The authorization server MUST support the OAuth bearer token profile for AAT issuance, and MAY support other OAuth token profiles. It MUST declare all supported token profiles and grant types for AAT issuance in its configuration data. Any OAuth authorization grant type might be appropriate depending on circumstances; for example, the client credentials grant is useful in the case of an organization acting as a requesting party. <a href="#UMA-Impl"><cite title="UMA Implementer's Guide">[UMA-Impl]</cite></a> discusses grant options further.</p></div><div id="rfc.section.1.3.2.p.5"><p>An AAT binds a requesting party, a client being used by that party, and an authorization server that protects resources this client is seeking access to on this requesting party's behalf. It is not specific to any resource server or resource owner. The issuance of an AAT represents the approval of this requesting party for this client to engage with this authorization server to supply claims, ask for authorization, and perform any other tasks needed for obtaining authorization for access to resources at all resource servers that use this authorization server. The authorization server is able to use this association to manage future processes of authorization and claims-caching efficiently for this client/requesting party pair across all resource servers they try to access; however, these management processes are outside the scope of this specification.</p></div></div><div id="resource-api"><h4 id="rfc.section.1.3.3"><a href="#rfc.section.1.3.3">1.3.3</a> <a href="#resource-api">Protected Resource Interface and Requesting Party Token</a></h4><div id="rfc.section.1.3.3.p.1"><p>The resource server MAY present to clients whatever HTTP-based APIs or endpoints it wishes. To protect any of its resources available in this fashion using UMA, it MUST require a requesting party token (RPT) with sufficient authorization data for access.</p></div><div id="rfc.section.1.3.3.p.2"><p>This specification defines one RPT profile, call <tt>Bearer</tt> (see <a href="#uma-bearer-token-profile" title="RPT Profile: Bearer">Section 3.4.2</a>), which the authorization server MUST support. It MAY support additional RPT profiles, and MUST declare all supported RPT profiles in its configuration data (see <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a>).</p></div><div id="rfc.section.1.3.3.p.3"><p>An RPT binds a requesting party, the client being used by that party, the resource server at which protected resources of interest reside, and the authorization server that protects those resources. It is not specific to a single resource owner, though its internal authorization data components are likely to be bound in practice to individual resource owners, depending on the RPT profile in use.</p></div><div id="rfc.section.1.3.3.p.4"><p>Note: The first step in the process of gaining access authorization is for a client to attempt access to the resource server's API without an RPT (as described in <a href="#without-rpt" title="Client Request to Resource Server With No RPT">Section 3.1.1</a>), and the second is for the resource server to register a requested permission on the client's behalf at the authorization server. This second step requires a PAT. In order for the resource server to know which authorization server to approach and which PAT (representing a resource owner) and resource set identifier to supply, the resource server's API needs be structured in such a way that it can derive this information from the client's RPT-free access attempt. In practice, this information likely needs to be passed through the URI, headers, or body of the client's request.</p></div></div><div><h4 id="rfc.section.1.3.4"><a href="#rfc.section.1.3.4">1.3.4</a> Time-to-Live Considerations</h4><div id="rfc.section.1.3.4.p.1"><p>The authorization server has the opportunity to manage the validity periods of access tokens that it issues, their corresponding refresh tokens where applicable, the individual authorization data components associated with RPTs where applicable, and even the client credentials that it issues. Different time-to-live strategies may be suitable for different resource sets and scopes of access, and the authorization server has the opportunity to give the resource owner control over lifetimes of tokens and authorization data issued on their behalf through policy. These options are all outside the scope of this specification.</p></div></div></div><div id="am-endpoints"><h3 id="rfc.section.1.4"><a href="#rfc.section.1.4">1.4</a> <a href="#am-endpoints">Authorization Server Configuration Data</a></h3><div id="rfc.section.1.4.p.1"><p>The authorization server MUST provide configuration data in a JSON document that resides in an <tt>/uma-configuration</tt> directory at its host-meta <a href="#RFC6415"><cite title="Web Host Metadata">[RFC6415]</cite></a> location. The configuration data documents endpoints and major conformance options supported by the authorization server.</p></div><div id="rfc.section.1.4.p.2"><p>The configuration data has the following properties.</p><dl><dt>version</dt><dd style="margin-left: 4.2em"><br>REQUIRED. The version of the UMA core protocol to which this authorization server conforms. The value MUST be the string <tt>"1.0"</tt>.</dd><dt>issuer</dt><dd style="margin-left: 4.2em"><br>REQUIRED. A URI with no query or fragment component that the authorization server asserts as its issuer identifier. This value MUST be identical to the web location of the configuration data minus the host-meta [hostmeta] and <tt>/uma-configuration</tt> path components.</dd><dt>pat_profiles_supported</dt><dd style="margin-left: 4.2em"><br>REQUIRED. OAuth access token types supported by this authorization server for PAT issuance. The property value is an array of string values, where each string value (which MAY be a URI) is a token type. Non-URI token type strings defined by OAuth token-defining specifications are privileged. For example, the type "<tt>bearer</tt>" stands for the OAuth bearer token type defined in <a href="#RFC6750"><cite title="The OAuth 2.0 Authorization Framework: Bearer Token Usage">[RFC6750]</cite></a>. The authorization server is REQUIRED to support "<tt>bearer</tt>", and to supply this value explicitly. The authorization server MAY declare its support for additional PAT profiles.</dd><dt>aat_profiles_supported</dt><dd style="margin-left: 4.2em"><br>REQUIRED. OAuth access token types supported by this authorization server for AAT issuance. The property value is an array of string values, where each string value (which MAY be a URI) is a token type. Non-URI token type strings defined by OAuth token-defining specifications are privileged. For example, the type "<tt>bearer</tt>" stands for the OAuth bearer token type defined in <a href="#RFC6750"><cite title="The OAuth 2.0 Authorization Framework: Bearer Token Usage">[RFC6750]</cite></a>. The authorization server is REQUIRED to support "<tt>bearer</tt>", and to supply this value explicitly. The authorization server MAY declare its support for additional AAT profiles.</dd><dt>rpt_profiles_supported</dt><dd style="margin-left: 4.2em"><br>REQUIRED. Profiles supported by this authorization server for RPT issuance. The property value is an array of string values, where each string value is a URI identifying an RPT profile. The authorization server is REQUIRED to support the <tt>Bearer</tt> RPT profile defined in <a href="#uma-bearer-token-profile" title="RPT Profile: Bearer">Section 3.4.2</a>, and to supply its identifying URI explicitly. The authorization server MAY declare its support for additional RPT profiles.</dd><dt>pat_grant_types_supported</dt><dd style="margin-left: 4.2em"><br>REQUIRED. OAuth grant types supported by this authorization server in issuing PATs. The property value is an array of string values, where each string value (which MAY be a URI) is a grant type. Non-URI token type strings defined by OAuth grant type-defining specifications are privileged. For example, the type <tt>authorization_code</tt> stands for the OAuth authorization code grant type defined in <a href="#RFC6749"><cite title="The OAuth 2.0 Authorization Framework">[RFC6749]</cite></a>.</dd><dt>aat_grant_types_supported</dt><dd style="margin-left: 4.2em"><br>REQUIRED. OAuth grant types supported by this authorization server in issuing AATs. The property value is an array of string values, where each string value (which MAY be a URI) is a grant type. Non-URI token type strings defined by OAuth grant type-defining specifications are privileged. For example, the type <tt>authorization_code</tt> stands for the OAuth authorization code grant type defined in <a href="#RFC6749"><cite title="The OAuth 2.0 Authorization Framework">[RFC6749]</cite></a>.</dd><dt>claim_token_profiles_supported</dt><dd style="margin-left: 4.2em"><br>OPTIONAL. Claim token format profiles supported by this authorization server. The property value is an array of string values, where each string value MAY be a URI.</dd><dt>uma_profiles_supported</dt><dd style="margin-left: 4.2em"><br>OPTIONAL. UMA profiles supported by this authorization server. The property value is an array of string values, where each string value is a URI identifying an UMA profile. Examples of UMA profiles are the API extensibility profiles defined in <a href="#comms-profiles" title="Profiles for API Extensibility">Section 5</a>.</dd><dt>dynamic_client_endpoint</dt><dd style="margin-left: 4.2em"><br>OPTIONAL. The endpoint to use for performing dynamic client registration in the case of the use of <a href="#RFC7591"><cite title="OAuth 2.0 Dynamic Client Registration Protocol">[RFC7591]</cite></a>, or alternatively the reserved string "<tt>openid</tt>" in the case of the use of <a href="#OIDCDynClientReg"><cite title="OpenID Connect Dynamic Client Registration 1.0 incorporating errata set 1">[OIDCDynClientReg]</cite></a>. In the latter case, it is presumed that the resource server or client will discover the dynamic client registration endpoint from the authorization server's published OpenID Provider Configuration Information. The presence of this property indicates authorization server support for dynamic client registration feature; its absence indicates a lack of support. If the authorization server supports dynamic client registration, it MUST allow client applications to register a <tt>claims_redirect_uri</tt> metadata field, as defined in <a href="#claim-redirect" title="Client Redirects Requesting Party to Authorization Server for Claims-Gathering">Section 3.6.3</a>.</dd><dt>token_endpoint</dt><dd style="margin-left: 4.2em"><br>REQUIRED. The endpoint URI at which the resource server or client asks the authorization server for a PAT or AAT. A requested scope of <tt>uma_protection</tt> results in a PAT. A requested scope of <tt>uma_authorization</tt> results in an AAT. Usage of this endpoint is defined by <a href="#RFC6749"><cite title="The OAuth 2.0 Authorization Framework">[RFC6749]</cite></a>.</dd><dt>authorization_endpoint</dt><dd style="margin-left: 4.2em"><br>REQUIRED. The endpoint URI at which the resource server gathers the consent of the end-user resource owner or the client gathers the consent of the end-user requesting party for issuance of a PAT or AAT respectively, if the <tt>authorization_code</tt> grant type is used. Usage of this endpoint is defined by <a href="#RFC6749"><cite title="The OAuth 2.0 Authorization Framework">[RFC6749]</cite></a>.</dd><dt>requesting_party_claims_endpoint</dt><dd style="margin-left: 4.2em"><br>OPTIONAL. The endpoint URI at which the authorization server interacts with the end-user requesting party to gather claims. If this property is absent, the authorization server does not interact with the end-user requesting party for claims gathering.</dd><dt>introspection_endpoint</dt><dd style="margin-left: 4.2em"><br>REQUIRED. The endpoint URI at which the resource server introspects an RPT presented to it by a client. Usage of this endpoint is defined by <a href="#RFC7662"><cite title="OAuth 2.0 Token Introspection">[RFC7662]</cite></a> and <a href="#token-introspection" title="Token Introspection Process">Section 3.4.1</a>. A valid PAT MUST accompany requests to this protected endpoint.</dd><dt>resource_set_registration_endpoint</dt><dd style="margin-left: 4.2em"><br>REQUIRED. The endpoint URI at which the resource server registers resource sets to put them under authorization manager protection. Usage of this endpoint is defined by <a href="#OAuth-resource-reg"><cite title="OAuth 2.0 Resource Set Registration">[OAuth-resource-reg]</cite></a> and <a href="#protecting-a-resource" title="Protecting a Resource">Section 2</a>. A valid PAT MUST accompany requests to this protected endpoint.</dd><dt>permission_registration_endpoint</dt><dd style="margin-left: 4.2em"><br>REQUIRED. The endpoint URI at which the resource server registers a requested permission that would suffice for a client's access attempt. Usage of this endpoint is defined by <a href="#register-permission" title="Resource Server Registers Requested Permission With Authorization Server">Section 3.2</a>. A valid PAT MUST accompany requests to this protected endpoint.</dd><dt>rpt_endpoint</dt><dd style="margin-left: 4.2em"><br>REQUIRED. The endpoint URI at which the client asks for authorization data. Usage of this endpoint is defined in <a href="#seek-authorization" title="Client Seeks Authorization for Access">Section 3.5</a>. A valid AAT and a permission ticket MUST, and an RPT MAY, accompany requests to this protected endpoint.</dd></dl></div><div id="rfc.figure.u.1"><p>Example of authorization server configuration data that resides at <tt>https://example.com/.well-known/uma-configuration</tt> (note the use of <tt>https:</tt> for endpoints throughout):</p><pre>{
"version":"1.0",
"issuer":"https://example.com",
"pat_profiles_supported":["bearer"],
"aat_profiles_supported":["bearer"],
"rpt_profiles_supported":
["https://docs.kantarainitiative.org/uma/profiles/uma-token-bearer-1.0"],
"pat_grant_types_supported":["authorization_code"],
"aat_grant_types_supported":["authorization_code"],
"claim_token_profiles_supported":["https://example.com/claims/formats/token1"],
"dynamic_client_endpoint":"https://as.example.com/dyn_client_reg_uri",
"token_endpoint":"https://as.example.com/token_uri",
"authorization_endpoint":"https://as.example.com/authz_uri",
"requesting_party_claims_endpoint":"https://as.example.com/rqp_claims_uri",
"resource_set_registration_endpoint":"https://as.example.com/rs/rsrc_uri",
"introspection_endpoint":"https://as.example.com/rs/status_uri",
"permission_registration_endpoint":"https://as.example.com/rs/perm_uri",
"rpt_endpoint":"https://as.example.com/client/rpt_uri"
}</pre></div><div id="rfc.section.1.4.p.3"><p>Where this specification does not already require optional features to be documented, it is RECOMMENDED that authorization server deployers document any profiled or extended features explicitly and use configuration data to indicate their usage.</p></div></div></div><hr class="noprint"><div id="protecting-a-resource"><h2 id="rfc.section.2" class="np"><a href="#rfc.section.2">2.</a> <a href="#protecting-a-resource">Protecting a Resource</a></h2><div id="rfc.section.2.p.1"><p>The resource owner, resource server, and authorization server perform the following actions to put resources under protection. This list assumes that the resource server has discovered the authorization server's configuration data and endpoints as needed.</p><ol><li>The authorization server issues client credentials to the resource server. It is OPTIONAL for the client credentials to be provided dynamically through <a href="#RFC7591"><cite title="OAuth 2.0 Dynamic Client Registration Protocol">[RFC7591]</cite></a> or <a href="#OIDCDynClientReg"><cite title="OpenID Connect Dynamic Client Registration 1.0 incorporating errata set 1">[OIDCDynClientReg]</cite></a>; alternatively, they MAY use a static process.</li><li>The resource server acquires a PAT (as defined in <a href="#protection-api" title="Protection API and Protection API Token">Section 1.3.1</a>) from the authorization server. It is OPTIONAL for the resource owner to introduce the resource server to the authorization server dynamically (for example, through a "NASCAR"-style user interface where the resource owner selects a chosen authorization server); alternatively, they MAY use a static process that may or may not directly involve the resource owner at introduction time.</li><li>In an ongoing fashion, the resource server registers any resource sets with the authorization server for which it intends to outsource protection, using the resource set registration endpoint of the protection API (see <a href="#OAuth-resource-reg"><cite title="OAuth 2.0 Resource Set Registration">[OAuth-resource-reg]</cite></a>).</li></ol></div><div id="rfc.section.2.p.2"><p>Note: The resource server is free to offer the option to protect any subset of the resource owner's resources using different authorization servers or other means entirely, or to protect some resources and not others. Additionally, the choice of protection regimes can be made explicitly by the resource owner or implicitly by the resource server. Any such partitioning by the resource server or owner is outside the scope of this specification.</p></div><div id="rfc.section.2.p.3"><p>Once a resource set has been placed under authorization server protection through the registration of a resource set description for it, and until such a description's deletion by the resource server, the resource server MUST limit access to corresponding resources, requiring sufficient authorization data associated with client-presented RPTs by the authorization server (see <a href="#permission-success-to-client" title="Resource Server Response to Client on Permission Registration Success">Section 3.3.1</a>).</p></div><div id="rfc.section.2.p.4"><p>Note: The PAT that the resource server uses to register resource sets must also be used later during client access attempts, for example, in registering a requested permission on a client's behalf (as described in <a href="#register-permission" title="Resource Server Registers Requested Permission With Authorization Server">Section 3.2</a>). One circumstance precipitating this action is when the client has attempted access without an RPT (as described in <a href="#without-rpt" title="Client Request to Resource Server With No RPT">Section 3.1.1</a>). In order for the resource server to know which authorization server to approach and which PAT (representing a resource owner) and resource set identifier to supply, the resource server's API needs be structured in such a way that it can derive this information from the client's RPT-free access attempt. In practice, this information likely needs to be passed through the URI, headers, or body of the client's request.</p></div></div><hr class="noprint"><div id="getting-authz-accessing-resource"><h2 id="rfc.section.3" class="np"><a href="#rfc.section.3">3.</a> <a href="#getting-authz-accessing-resource">Getting Authorization and Accessing a Resource</a></h2><div id="rfc.section.3.p.1"><p>An authorization server orchestrates and controls clients' access on their requesting parties' behalf to a resource owner's protected resources at a resource server, under conditions specified by that resource owner through policy.</p></div><div id="rfc.section.3.p.2"><p>The process of getting authorization and accessing a resource always begins with the client attempting access at a protected resource endpoint at the resource server. Several aspects of the client's behavior are out of scope for this specification:</p><ul><li>How the client acquired knowledge of the resource server's client-facing interface and the specific endpoint of the desired protected resource. For example, the resource server might have a formally documented API or it might serve up a simple web page, and the resource owner might have advertised the endpoint publicly on a blog or other website, listed it in a discovery service, or emailed a link to a particular intended requesting party. Note: A client first attempts access to a resource without an RPT, and the resource server next needs to make a request at the authorization server to continue the authorization-seeking process. In order for the resource server to know which authorization server to approach and which PAT (representing a resource owner) and resource set identifier to supply on that request, the resource server's API needs be structured in such a way that it can derive this information from the client's RPT-free access attempt. In practice, this information likely needs to be passed through the URI, headers, or body of the client's request.</li><li>The impetus for the client's access attempt. For example, its end-user requesting party might have clicked on a thumbnail representation of a graphics-based resource to retrieve a larger version.</li></ul></div><div id="rfc.section.3.p.3"><p>In brief, the entire process is as follows. </p><ul><li>The client attempts to access the protected resource (see <a href="#client-attempts-access" title="Client Attempts Access to Protected Resource">Section 3.1</a>).</li><li>If the client's request at the protected resource has no RPT, or has an invalid RPT or insufficient authorization data associated with the RPT as determined through RPT status checking (see <a href="#check-rpt-status" title="Resource Server Determines RPT Status">Section 3.4</a>), the resource server registers a requested permission with the relevant authorization server (see <a href="#register-permission" title="Resource Server Registers Requested Permission With Authorization Server">Section 3.2</a>), and responds to the client with the resulting permission ticket and the authorization server's location using a <tt>WWW-Authenticate: UMA</tt> header (see <a href="#permission-success-to-client" title="Resource Server Response to Client on Permission Registration Success">Section 3.3.1</a>).</li><li>If the resource server fails to get a permission ticket, it responds to the client with a warning header instead (see <a href="#permission-failure-to-client" title="Resource Server Response to Client on Permission Registration Failure">Section 3.3.2</a>).</li><li>If the client receives a permission ticket and authorization server location from the resource server, it requests authorization data from the authorization server (see <a href="#seek-authorization" title="Client Seeks Authorization for Access">Section 3.5</a>).</li><li>If the authorization request and any additional information required for trust elevation by the authorization server (see <a href="#need-info" title="Client Responds to Authorization Server's Request for Additional Information">Section 3.6</a>) sufficiently matches resource owner policies, the authorization server returns an RPT associated with the appropriate authorization data to the client (see <a href="#give-rpt" title="Authorization Server Response to Client on Authorization Success">Section 3.5.3</a>).</li><li>If the client's attempt has a valid RPT with sufficient authorization data, the resource owner's policies have been met for access to the protected resource (see <a href="#give-access" title="Resource Server Response to Client on Sufficiency of Authorization">Section 3.3.3</a>).</li></ul></div><div id="rfc.section.3.p.4"><p>The recipient of each request message SHOULD respond unless it detects a security concern, such as a suspected denial of service attack that can be mitigated by rate limiting.</p></div><div id="client-attempts-access"><h3 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1</a> <a href="#client-attempts-access">Client Attempts Access to Protected Resource</a></h3><div id="rfc.section.3.1.p.1"><p>This interaction assumes that the resource server has already registered any relevant resource sets prior to the client's access attempt at any resource that is intended to be UMA-protected.</p></div><div id="without-rpt"><h4 id="rfc.section.3.1.1"><a href="#rfc.section.3.1.1">3.1.1</a> <a href="#without-rpt">Client Request to Resource Server With No RPT</a></h4><div id="rfc.figure.u.2"><p>Example of a client request at a protected resource carrying no RPT:</p><pre>
GET /users/alice/album/photo.jpg HTTP/1.1
Host: photoz.example.com
...
</pre></div><div id="rfc.section.3.1.1.p.1"><p>If the resource server chooses to respond, it next registers a requested permission (see <a href="#register-permission" title="Resource Server Registers Requested Permission With Authorization Server">Section 3.2</a>).</p></div></div><div id="with-rpt"><h4 id="rfc.section.3.1.2"><a href="#rfc.section.3.1.2">3.1.2</a> <a href="#with-rpt">Client Request to Resource Server With RPT</a></h4><div id="rfc.figure.u.3"><p>Example of a client request at a protected resource carrying an RPT using the UMA <tt>Bearer</tt> RPT profile:</p><pre>
GET /users/alice/album/photo.jpg HTTP/1.1
Authorization: Bearer vF9dft4qmT
Host: photoz.example.com
...
</pre></div><div id="rfc.section.3.1.2.p.1"><p>If the resource server chooses to respond, it next determines the RPT's status (see <a href="#check-rpt-status" title="Resource Server Determines RPT Status">Section 3.4</a>).</p></div></div></div><div id="register-permission"><h3 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2</a> <a href="#register-permission">Resource Server Registers Requested Permission With Authorization Server</a></h3><div id="rfc.section.3.2.p.1"><p>If the client's request at the protected resource has no RPT, or has an invalid RPT or insufficient authorization data associated with the RPT as determined through RPT status checking (see <a href="#check-rpt-status" title="Resource Server Determines RPT Status">Section 3.4</a>), then assuming the resource server chooses to respond to the client, it MUST use the protection API's permission registration endpoint to register a requested permission with the corresponding authorization server. The extent of the requested permission MUST suffice for the extent of the client's access attempt at that resource.</p></div><div id="rfc.section.3.2.p.2"><p>Note: The resource server is free to choose the extent of the requested permission that it registers, as long as it minimally suffices for the access attempted by the client. For example, it can choose to register a permission that covers several scopes or a resource set that is greater in extent than the specific resource that the client attempted to access.</p></div><div id="rfc.section.3.2.p.3"><p>The PAT provided in the API request enables the authorization server to map the requested permission to the appropriate resource owner. The authorization server returns a permission ticket in its response for the resource server to give to the client that represents the same extent of requested access that the resource server registered.</p></div><div><h4 id="rfc.section.3.2.1"><a href="#rfc.section.3.2.1">3.2.1</a> Resource Server Request to Permission Registration Endpoint</h4><div id="rfc.section.3.2.1.p.1"><p>The resource server uses the POST method at the permission registration endpoint. The body of the HTTP request message contains a JSON object providing the requested permission, using a format derived from the resource set description format specified in <a href="#OAuth-resource-reg"><cite title="OAuth 2.0 Resource Set Registration">[OAuth-resource-reg]</cite></a>, as follows. The object has the following properties:</p><dl><dt>resource_set_id</dt><dd>REQUIRED. The identifier for a resource set to which this client is seeking access. The identifier MUST correspond to a resource set that was previously registered.</dd><dt>scopes</dt><dd>REQUIRED. An array referencing one or more identifiers of scopes to which access is needed for this resource set. Each scope identifier MUST correspond to a scope that was registered by this resource server for the referenced resource set.</dd></dl></div><div id="rfc.figure.u.4"><p>Example of an HTTP request that registers a requested permission at the authorization server's permission registration endpoint, with a PAT in the header:</p><pre>
POST /host/rsrc_uri HTTP/1.1
Content-Type: application/json
Host: as.example.com
Authorization: Bearer 204c69636b6c69

{
  "resource_set_id": "112210f47de98100",
  "scopes": [
      "view",
      "http://photoz.example.com/dev/actions/print"
  ]
}
</pre></div></div><div id="ticket-management"><h4 id="rfc.section.3.2.2"><a href="#rfc.section.3.2.2">3.2.2</a> <a href="#ticket-management">Permission Ticket Creation and Management</a></h4><div id="rfc.section.3.2.2.p.1"><p>The authorization server uses a permission ticket to maintain the state of requested permission information, initially conveyed on the client's behalf by the resource server at attempted resource access time, for the period of time that the client continues to seek authorization for that attempted access.</p></div><div id="rfc.section.3.2.2.p.2"><p>The permission ticket is a short-lived correlation handle generated by the authorization server that is intended to be opaque to resource servers and clients. The authorization server therefore MUST ensure that the ticket is securely random, much as it would for authorization codes and access tokens. Within these constraints, however, the authorization server MAY format the ticket however it chooses, for example either as a random string that references data held on the server or by including data within the ticket itself.</p></div><div id="rfc.section.3.2.2.p.3"><p>Since permission tickets are used only by clients bearing an AAT at the authorization server, the authorization server can associate a permission ticket with both a client and a requesting party at the time the client first makes a request at the RPT endpoint. If the authorization server observes that a permission ticket is used by multiple different clients, it SHOULD attempt to revoke any RPT already granted based on the compromised permission ticket.</p></div><div id="rfc.section.3.2.2.p.4"><p>Permission tickets MUST NOT be single-use; this is in order to allow the client to interact with the authorization server during the claims-gathering flow, which may require multiple interactions, either direct or through redirection of a requesting party.</p></div><div id="rfc.section.3.2.2.p.5"><p>The authorization server MUST invalidate a permission ticket when an RPT is successfully granted to a client based on this permission ticket or when the permission ticket expires, whichever occurs first.</p></div><div id="rfc.section.3.2.2.p.6"><p>See <a href="#UMA-Impl"><cite title="UMA Implementer's Guide">[UMA-Impl]</cite></a> for more information about permission ticket management.</p></div></div><div><h4 id="rfc.section.3.2.3"><a href="#rfc.section.3.2.3">3.2.3</a> Authorization Server Response to Resource Server on Permission Registration Success</h4><div id="rfc.section.3.2.3.p.1"><p>If the authorization server is successful in creating a permission ticket in response to the resource server's request, it responds with an HTTP 201 (Created) status code and includes the <tt>ticket</tt> property in the JSON-formatted body.</p></div><div id="rfc.figure.u.5"><p>For example:</p><pre>
HTTP/1.1 201 Created
Content-Type: application/json
...

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}
</pre></div></div><div><h4 id="rfc.section.3.2.4"><a href="#rfc.section.3.2.4">3.2.4</a> Authorization Server Response to Resource Server on Permission Registration Failure</h4><div id="rfc.section.3.2.4.p.1"><p>If the resource server's permission registration request is authenticated properly but fails due to other reasons, the authorization server responds with an HTTP 400 (Bad Request) status code and includes one of the following UMA error codes (see <a href="#uma-error-response" title="UMA Error Responses">Section 4.2</a> for more information about error codes and responses):</p><dl><dt>invalid_resource_set_id</dt><dd>The provided resource set identifier was not found at the authorization server.</dd><dt>invalid_scope</dt><dd>At least one of the scopes included in the request was not registered previously by this resource server.</dd></dl></div></div></div><div><h3 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3</a> Resource Server Responds to Client</h3><div id="rfc.section.3.3.p.1"><p>If the resource server chooses to respond to the client's access attempt, it has three possible paths.</p></div><div id="permission-success-to-client"><h4 id="rfc.section.3.3.1"><a href="#rfc.section.3.3.1">3.3.1</a> <a href="#permission-success-to-client">Resource Server Response to Client on Permission Registration Success</a></h4><div id="rfc.section.3.3.1.p.1"><p>If the client's request at a protected resource has no RPT, or has an invalid RPT or insufficient authorization data associated with the RPT as determined through RPT status checking (see <a href="#check-rpt-status" title="Resource Server Determines RPT Status">Section 3.4</a>), and the resource server successfully registered a requested permission and received a permission ticket (see <a href="#register-permission" title="Resource Server Registers Requested Permission With Authorization Server">Section 3.2</a>), then assuming the resource server chooses to respond to the client with an UMA response, it MUST provide a <tt>WWW-Authenticate</tt> header with the authentication scheme <tt>UMA</tt>, with the <tt>issuer</tt> URI from the authorization server's configuration data in an <tt>as_uri</tt> parameter and the just-received permission ticket in a <tt>ticket</tt> parameter.</p></div><div id="rfc.section.3.3.1.p.2"><p>If the resource server responds with the HTTP status code 403 (Forbidden), it MAY also return the same permission ticket in the body in a JSON-encoded <tt>ticket</tt> property. Note: The appearance of the permission ticket in a response body is deprecated and will be removed in a future UMA version. It is included here for backwards compatibility.</p></div><div id="rfc.figure.u.6"><p>Example of the resource server's response to a client after having registered a requested permission and received a ticket:</p><pre>
HTTP/1.1 401 Unauthorized
WWW-Authenticate: UMA realm="example",
  as_uri="https://as.example.com",
  ticket="016f84e8-f9b9-11e0-bd6f-0021cc6004de"
   ...
</pre></div><div id="rfc.figure.u.7"><p>Alternate example illustrating a response with HTTP status code 403 (Forbidden):</p><pre>
HTTP/1.1 403 Forbidden
WWW-Authenticate: UMA realm="example",
  as_uri="https://as.example.com",
  error="insufficient_scope",
  ticket="016f84e8-f9b9-11e0-bd6f-0021cc6004de"

{
"ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}
</pre></div><div id="rfc.section.3.3.1.p.3"><p>On receiving a response from the resource server with permission ticket and authorization server location information, the client next seeks authorization (see <a href="#seek-authorization" title="Client Seeks Authorization for Access">Section 3.5</a>).</p></div></div><div id="permission-failure-to-client"><h4 id="rfc.section.3.3.2"><a href="#rfc.section.3.3.2">3.3.2</a> <a href="#permission-failure-to-client">Resource Server Response to Client on Permission Registration Failure</a></h4><div id="rfc.section.3.3.2.p.1"><p>If the client's request at the protected resource has no RPT, or has an invalid RPT or insufficient authorization data associated with the RPT as determined through RPT status checking (see <a href="#check-rpt-status" title="Resource Server Determines RPT Status">Section 3.4</a>), and the resource server received an error of any kind from the authorization server when trying to register a requested permission such that it did not receive a permission ticket, then assuming the resource server chooses to respond to the client, it is unable to create a <tt>WWW-Authenticate: UMA</tt> header and MUST include a header of the following form in its response to the client: <tt>Warning: 199 - "UMA Authorization Server Unreachable"</tt>.</p></div><div id="rfc.figure.u.8"><p>For example:</p><pre>
HTTP/1.1 403 Forbidden
Warning: 199 - "UMA Authorization Server Unreachable"

...
</pre></div></div><div id="give-access"><h4 id="rfc.section.3.3.3"><a href="#rfc.section.3.3.3">3.3.3</a> <a href="#give-access">Resource Server Response to Client on Sufficiency of Authorization</a></h4><div id="rfc.section.3.3.3.p.1"><p>The client's presentation of a valid RPT associated with sufficient authorization data as determined through RPT status checking (see <a href="#check-rpt-status" title="Resource Server Determines RPT Status">Section 3.4</a>) indicates that the resource owner's policies have been met for access to the protected resource. The resource server MAY apply additional authorization controls when determining how to respond.</p></div><div id="rfc.figure.u.9"><p>Example of the resource server's response to the client:</p><pre>
HTTP/1.1 200 OK
Content-Type: application/json
...
{
  "f_number": "f/5.6",
  "exposure": "1/320",
  "focal_length_mm": 150,
  "iso": 400,
  "flash": false
}

</pre></div><div id="rfc.section.3.3.3.p.2"><p>The resource server MUST NOT give access in the case of an invalid RPT or an RPT associated with insufficient authorization. To ensure the integrity of the ecosystem in which the resource server, authorization server, and resource owner are participating, it is RECOMMENDED for the parties to establish agreements about access rules in this case on a legal or contractual level. See <a href="#trust-considerations" title="Profiles and Trust Establishment">Section 7.4</a> for more information.</p></div></div></div><div id="check-rpt-status"><h3 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4</a> <a href="#check-rpt-status">Resource Server Determines RPT Status</a></h3><div id="rfc.section.3.4.p.1"><p>If a client's request at a protected endpoint has an RPT, and the resource server chooses to respond to the client, then it MUST determine the RPT's status, including whether it is active and, if so, its associated authorization data indicating whether the client is authorized for access before taking next actions.</p></div><div id="rfc.section.3.4.p.2"><p>This specification makes one type of RPT REQUIRED for the authorization server to support: the UMA bearer token profile, as defined in <a href="#uma-bearer-token-profile" title="RPT Profile: Bearer">Section 3.4.2</a>. Implementers MAY define and use other RPT profiles.</p></div><div id="token-introspection"><h4 id="rfc.section.3.4.1"><a href="#rfc.section.3.4.1">3.4.1</a> <a href="#token-introspection">Token Introspection Process</a></h4><div id="rfc.section.3.4.1.p.1"><p>The RPT's nature and format are dictated by its profile; the profile might allow it to be self-contained, such that the resource server is able to introspect its status and associated authorization data locally, or might require or allow the resource server to make a run-time introspection request of the authorization server that issued the token.</p></div><div id="rfc.section.3.4.1.p.2"><p>Within any RPT profile, when a resource server needs to introspect a token in a non-self-contained way to determine its status, it MAY require, allow, or prohibit use of the OAuth token introspection endpoint (defined by <a href="#RFC7662"><cite title="OAuth 2.0 Token Introspection">[RFC7662]</cite></a>) that is part of the protection API, and MAY profile its usage.</p></div></div><div id="uma-bearer-token-profile"><h4 id="rfc.section.3.4.2"><a href="#rfc.section.3.4.2">3.4.2</a> <a href="#uma-bearer-token-profile">RPT Profile: Bearer</a></h4><div id="rfc.section.3.4.2.p.1"><p>This section defines the UMA bearer token profile. Following is a summary:</p><ul><li>Identifying URI: https://docs.kantarainitiative.org/uma/profiles/uma-token-bearer-1.0</li><li>Profile author and contact information: Thomas Hardjono (hardjono@mit.edu)</li><li>Updates or obsoletes: None; this profile is new.</li><li>Keyword in HTTP Authorization header: <tt>Bearer</tt>.</li><li>Syntax and semantics of token data: As defined below; an opaque string value, resolving to a JSON object that leverages some JSON Web Token (JWT) <a href="#RFC7519"><cite title="JSON Web Token (JWT)">[RFC7519]</cite></a> claims and elements.</li><li>Token data association: The on-the-wire token is opaque; it is introspected at run time by the resource server through profiled use of the OAuth token introspection endpoint <a href="#RFC7662"><cite title="OAuth 2.0 Token Introspection">[RFC7662]</cite></a>, as defined below.</li><li>Token data processing: As defined in this section and throughout <a href="#getting-authz-accessing-resource" title="Getting Authorization and Accessing a Resource">Section 3</a> of this specification.</li><li>Grant type restrictions: None.</li><li>Error states: As defined below.</li><li>Security and privacy considerations: As defined in this section, throughout <a href="#getting-authz-accessing-resource" title="Getting Authorization and Accessing a Resource">Section 3</a>, and in <a href="#sec-consid" title="Security Considerations">Section 7</a>.</li></ul></div><div id="rfc.section.3.4.2.p.2"><p>An example of a client making a request with an RPT using the <tt>Bearer</tt> scheme appears in <a href="#with-rpt" title="Client Request to Resource Server With RPT">Section 3.1.2</a>.</p></div><div id="rfc.section.3.4.2.p.3"><p>On receiving an RPT with the <tt>Bearer</tt> scheme in an authorization header from a client making an access attempt, the resource server introspects the token by using the token introspection endpoint of the protection API. The PAT used by the resource server to make the introspection request provides resource-owner context to the authorization server.</p></div><div id="rfc.section.3.4.2.p.4"><p>The authorization server responds with a JSON object with the structure dictated by <a href="#RFC7662"><cite title="OAuth 2.0 Token Introspection">[RFC7662]</cite></a>. If the <tt>active</tt> property has a Boolean value of <tt>true</tt>, then the JSON object MUST NOT contain a <tt>scope</tt> claim, and MUST contain an extension property with the name <tt>permissions</tt> that contains an array of zero or more values, each of which is an object consisting of these properties:</p><dl><dt>resource_set_id</dt><dd>REQUIRED. A string that uniquely identifies the resource set, access to which has been granted to this client on behalf of this requesting party. The identifier MUST correspond to a resource set that was previously registered as protected.</dd><dt>scopes</dt><dd>REQUIRED. An array referencing one or more strings representing scopes to which access was granted for this resource set. Each string MUST correspond to a scope that was registered by this resource server for the referenced resource set.</dd><dt>exp</dt><dd>OPTIONAL. Integer timestamp, measured in the number of seconds since January 1 1970 UTC, indicating when this permission will expire. If the property is absent, the permission does not expire. If the token-level <tt>exp</tt> value pre-dates a permission-level <tt>exp</tt> value, the former overrides the latter.</dd><dt>iat</dt><dd>OPTIONAL. Integer timestamp, measured in the number of seconds since January 1 1970 UTC, indicating when this permission was originally issued. If the token-level <tt>iat</tt> value post-dates a permission-level <tt>iat</tt> value, the former overrides the latter.</dd><dt>nbf</dt><dd>OPTIONAL. Integer timestamp, measured in the number of seconds since January 1 1970 UTC, indicating the time before which this permission is not valid. If the token-level <tt>nbf</tt> value post-dates a permission-level <tt>nbf</tt> value, the former overrides the latter.</dd></dl></div><div id="rfc.figure.u.10"><p>Example:</p><pre>
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store

   {
    "active": true,
    "exp": 1256953732,
    "iat": 1256912345,
    "permissions": [
      {
        "resource_set_id": "112210f47de98100",
        "scopes": [
          "view",
          "http://photoz.example.com/dev/actions/print"
         ],
        "exp" : 1256953732
      }
    ]
   }
</pre></div></div></div><div id="seek-authorization"><h3 id="rfc.section.3.5"><a href="#rfc.section.3.5">3.5</a> <a href="#seek-authorization">Client Seeks Authorization for Access</a></h3><div id="rfc.section.3.5.p.1"><p>In order to access a protected resource successfully, a client needs to present a valid RPT with sufficient authorization data. The client uses the authorization API to acquire an RPT and to ask for authorization data, providing the permission ticket it received from the resource server.</p></div><div id="rfc.section.3.5.p.2"><p>This interaction depends on the following preconditions:</p><ul><li>The client has obtained a permission ticket and an authorization server location from the resource server (see <a href="#permission-success-to-client" title="Resource Server Response to Client on Permission Registration Success">Section 3.3.1</a>).</li><li>This client has discovered the authorization server's configuration data and endpoints as needed.</li><li>The client has obtained OAuth client credentials from the authorization server. It is OPTIONAL for the client credentials to be provided dynamically through <a href="#RFC7591"><cite title="OAuth 2.0 Dynamic Client Registration Protocol">[RFC7591]</cite></a> or <a href="#OIDCDynClientReg"><cite title="OpenID Connect Dynamic Client Registration 1.0 incorporating errata set 1">[OIDCDynClientReg]</cite></a>; alternatively, they MAY use a static process. The client SHOULD register a <tt>claims_redirect_uri</tt> (as defined in <a href="#claim-redirect" title="Client Redirects Requesting Party to Authorization Server for Claims-Gathering">Section 3.6.3</a>) with the authorization server, either using a static process or through <a href="#RFC7591"><cite title="OAuth 2.0 Dynamic Client Registration Protocol">[RFC7591]</cite></a> or <a href="#OIDCDynClientReg"><cite title="OpenID Connect Dynamic Client Registration 1.0 incorporating errata set 1">[OIDCDynClientReg]</cite></a>.</li><li>The client has acquired an AAT (as defined in <a href="#authorization-api" title="Authorization API and Authorization API Token">Section 1.3.2</a>) from the authorization server. The exact means by which the client acquires the AAT are out of scope of this specification. In the case of an interactive OAuth flow, an end-user requesting party will need to be available to authorize issuance of the <tt>uma_authorization</tt> scope.</li></ul></div><div><h4 id="rfc.section.3.5.1"><a href="#rfc.section.3.5.1">3.5.1</a> Client Request to Authorization Server for Authorization Data</h4><div id="rfc.section.3.5.1.p.1"><p>The client performs a POST on the RPT endpoint, supplying its own AAT in the header and a JSON object in the body with a <tt>ticket</tt> property containing the permission ticket as its value. If the client had included an RPT in its failed access attempt, it MAY also provide that RPT in an <tt>rpt</tt> property in the body.</p></div><div id="rfc.section.3.5.1.p.2"><p>In circumstances where the client needs to provide requesting party claims to the authorization server, it MAY also include a <tt>claim_tokens</tt> property in its request; see <a href="#claim-push" title="Client Pushes Claim Tokens to Authorization Server">Section 3.6.2</a> for more information.</p></div><div id="rfc.figure.u.11"><p>Example of a request message containing an AAT, an RPT, and a permission ticket:</p><pre>POST /rpt_uri HTTP/1.1
Host: as.example.com
Authorization: Bearer jwfLG53^sad$#f
...

{
 "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
 "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
}</pre></div></div><div id="authorization-assessment"><h4 id="rfc.section.3.5.2"><a href="#rfc.section.3.5.2">3.5.2</a> <a href="#authorization-assessment">Authorization Assessment Process</a></h4><div id="rfc.section.3.5.2.p.1"><p>The authorization server uses the permission ticket to look up the details of the previously registered requested permission, maps the requested permission to operative resource owner policies based on the resource set identifier and scopes associated with it, potentially requests additional information and receives additional information such as claims, and ultimately responds positively or negatively to the request for authorization data.</p></div><div id="rfc.section.3.5.2.p.2"><p>The authorization server bases the issuance of authorization data on resource owner policies. Thus, these policies function as authorization that has been granted ahead of time. The authorization server is also free to enable the resource owner to set policies that require the owner to interact with the server to authorize an access attempt in near-real time, or to help the resource owner field access requests as acts of post hoc authorization. Thus, authorization by UMA methods constitutes an asynchronous authorization grant. All such processes are outside the scope of this specification.</p></div><div id="rfc.section.3.5.2.p.3"><p>Note: If the client incompletely satisfies any policy criteria, the authorization server is free either to partially fulfill the elements of that request, for example, granting authorization to some scopes associated with a requested permission but not all, or to reject the request.</p></div><div id="rfc.section.3.5.2.p.4"><p>The authorization server MUST use a default-deny authorization assessment model in adding authorization data to RPTs, that is, "everything that is not expressly allowed is forbidden" for resource sets that resource servers have registered. Exercise caution in implementing default-deny because corner cases can inadvertently result in default-permit behavior. For example, it is insufficient simply to assume that all resource sets have some non-zero set of claims required for access, and then accept an empty set of supplied claims as sufficient for access. See <a href="#UMA-Impl"><cite title="UMA Implementer's Guide">[UMA-Impl]</cite></a> for further discussion.</p></div></div><div id="give-rpt"><h4 id="rfc.section.3.5.3"><a href="#rfc.section.3.5.3">3.5.3</a> <a href="#give-rpt">Authorization Server Response to Client on Authorization Success</a></h4><div id="rfc.section.3.5.3.p.1"><p>If the authorization server's assessment process results in issuance of authorization data (see <a href="#authorization-assessment" title="Authorization Assessment Process">Section 3.5.2</a>), it returns an HTTP 200 (OK) status code with a response body containing the RPT with which it has associated the requested authorization data.</p></div><div id="rfc.section.3.5.3.p.2"><p>If the client did not present an RPT in the request for authorization data, the authorization server creates and returns a new RPT. If the client did present an RPT in the request, the authorization server returns the RPT with which it associated the requested authorization data, which MAY be either the RPT that was in the request or a new one.</p></div><div id="rfc.section.3.5.3.p.3"><p>Note: The authorization server is free to choose to return either the same RPT that appeared in the request or a new RPT, and it is also free to choose to invalidate or retain the validity of the original RPT or any authorization data that was previously added to that RPT; to assist in client interoperability and token caching expectations, it is RECOMMENDED that authorization servers document their practices. <a href="#UMA-Impl"><cite title="UMA Implementer's Guide">[UMA-Impl]</cite></a> discusses the implications.</p></div><div id="rfc.figure.u.12"><p>Example:</p><pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv"
}

</pre></div></div><div id="authorization-failure"><h4 id="rfc.section.3.5.4"><a href="#rfc.section.3.5.4">3.5.4</a> <a href="#authorization-failure">Authorization Server Response to Client on Authorization Failure</a></h4><div id="rfc.section.3.5.4.p.1"><p>If the authorization server does not add the requested authorization data, it responds using one of the following UMA error codes and corresponding HTTP status codes (see <a href="#uma-error-response" title="UMA Error Responses">Section 4.2</a> for more information about error codes and responses):</p><dl><dt>invalid_ticket</dt><dd>The provided ticket was not found at the authorization server. The authorization server responds with the HTTP 400 (Bad Request) status code.</dd><dt>expired_ticket</dt><dd>The provided ticket has expired. The authorization server responds with the HTTP 400 (Bad Request) status code.</dd><dt>not_authorized</dt><dd>The client is not authorized to have this authorization data added. The authorization server responds with the HTTP 403 (Forbidden) status code.</dd><dt>need_info</dt><dd>The authorization server needs additional information in order to determine whether the client is authorized to have this authorization data. The authorization server responds with the HTTP 403 (Forbidden) status code. It MAY also respond with an <tt>error_details</tt> object that contains one or more sub-properties with hints about the nature of further required information. The client then has the opportunity to engage in follow-on flows to continue seeking authorization (see <a href="#need-info" title="Client Responds to Authorization Server's Request for Additional Information">Section 3.6</a>).</dd><dt>request_submitted</dt><dd>The authorization server requires intervention by the resource owner to determine whether the client is authorized to have this authorization data. Further immediate interaction between the client and authorization server is out of scope of this specification.</dd></dl></div><div id="rfc.figure.u.13"><p>Example when the ticket has expired:</p><pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
...

{
  "error": "expired_ticket"
}
</pre></div><div id="rfc.figure.u.14"><p>Example of a <tt>need_info</tt> response with a full set of <tt>error_details</tt> hints:</p><pre>
HTTP/1.1 403 Forbidden
Content-Type: application/json
Cache-Control: no-store
...

{
 "error": "need_info",
 "error_details": {
   "authentication_context": {
     "required_acr": ["https://example.com/acrs/LOA3.14159"]
   },
   "requesting_party_claims": {
     "required_claims": [
       {
         "name": "email23423453ou453",
         "friendly_name": "email",
         "claim_type": "urn:oid:0.9.2342.19200300.100.1.3",
         "claim_token_format": 
["http://openid.net/specs/openid-connect-core-1_0.html#HybridIDToken"],
         "issuer": ["https://example.com/idp"]
       }
     ],
     "redirect_user": true,
     "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de"
   }
 }
}
</pre></div><div id="authn-flows"><h5 id="rfc.section.3.5.4.1"><a href="#rfc.section.3.5.4.1">3.5.4.1</a> <a href="#authn-flows">Error Details About Authentication Context</a></h5><div id="rfc.section.3.5.4.1.p.1"><p>The <tt>authentication_context</tt> sub-property of the <tt>error_details</tt> object provides hints about additional requirements regarding the requesting party's authentication that underlies the issuance of the currently valid AAT. The <tt>authentication_context</tt> sub-property contains the following parameter:</p><dl><dt>required_acr</dt><dd>REQUIRED. An array of strings specifying a set of acceptable authentication context class reference values. Any one of the referenced authentication context classes (sets of authentication methods or procedures considered to be equivalent in a particular context) would satisfy the requesting party authentication requirements. Each string MAY be a URI, including one that has been registered through <a href="#RFC6711"><cite title="An IANA Registry for Level of Assurance (LoA) Profiles">[RFC6711]</cite></a>.</dd></dl></div><div id="rfc.section.3.5.4.1.p.2"><p>See <a href="#step-up" title="Client Redirects Requesting Party to Authorization Server for Authentication">Section 3.6.1</a> for the client's next option.</p></div></div><div id="authz-flows"><h5 id="rfc.section.3.5.4.2"><a href="#rfc.section.3.5.4.2">3.5.4.2</a> <a href="#authz-flows">Error Details About Claims</a></h5><div id="rfc.section.3.5.4.2.p.1"><p>The <tt>requesting_party_claims</tt> sub-property of the <tt>error_details</tt> object provides hints about additional requirements regarding information the authorization server needs about the requesting party. On receiving such hints, the client has the opportunity to engage in claims-gathering flows of various types. The <tt>requesting_party_claims</tt> sub-property MAY contain the following parameters, where at least one of <tt>required_claims</tt> or <tt>redirect_user</tt> MUST be supplied:</p><dl><dt>required_claims</dt><dd>An array containing objects that describe characteristics of the required claims, with the following properties:<dl><dt>name</dt><dd>OPTIONAL. A string (which MAY be a URI) representing the name of the claim; the "key" in a key-value pair.</dd><dt>friendly_name</dt><dd>OPTIONAL. A string that provides a more human-readable form of the attribute's name, which may be useful as a "display name" for use in user interfaces in cases where the actual name is complex or opaque, such as an OID or a UUID.</dd><dt>claim_type</dt><dd>OPTIONAL. A string, indicating the expected interpretation of the provided claim value. The string MAY be a URI.</dd><dt>claim_token_format</dt><dd>OPTIONAL. An array of strings specifying a set of acceptable formats for a token pushed by the client containing this claim (see <a href="#claim-push" title="Client Pushes Claim Tokens to Authorization Server">Section 3.6.2</a>). Any one of the referenced formats would satisfy the authorization server's requirements. Each string MAY be a URI.</dd><dt>issuer</dt><dd>OPTIONAL. An array of strings specifying a set of acceptable issuing authorities for the claim. Any one of the referenced authorities would satisfy the authorization server's requirements. Each string MAY be a URI.</dd></dl></dd><dt>redirect_user</dt><dd>A Boolean value indicating whether the requesting party's presence at the authorization server is required for the process of claims gathering. For example, the authorization server may require the requesting party to fill out a CAPTCHA to help prove humanness. The default is <tt>false</tt> if this parameter is not present. See <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a> for how the authorization server declares the requesting party claims endpoint to which the client has the opportunity to redirect the requesting party. Note that the word "user" implies an end-user (human) requesting party; if the requesting party is not an end-user, then no client action would be possible on receiving the hint.</dd><dt>ticket</dt><dd>The permission ticket that was in the client's request for authorization data. If the authorization server provides the <tt>redirect_user</tt> property, it MAY also provide the <tt>ticket</tt> property. If it is provided, the client SHOULD NOT depend on the ticket's accuracy. Note: The appearance of the permission ticket is deprecated and will be removed in a future UMA version. It is included here for backwards compatibility.</dd></dl></div><div id="rfc.section.3.5.4.2.p.2"><p>The authorization server has many options for gathering requesting party claims. For example, it could interact with an end-user requesting party directly, or accept claims delivered by a client, or perform a lookup in some external system. The process is extensible and can have dependencies on the type of requesting party (for example, natural person or legal person) or client (for example, browser, native app, or autonomously running web service).</p></div><div id="rfc.section.3.5.4.2.p.3"><p>The client and authorization server next have options for two nonexclusive claims-gathering interaction patterns: push (see <a href="#claim-push" title="Client Pushes Claim Tokens to Authorization Server">Section 3.6.2</a>) and redirect (see <a href="#claim-redirect" title="Client Redirects Requesting Party to Authorization Server for Claims-Gathering">Section 3.6.3</a>). (See <a href="#sec-consid" title="Security Considerations">Section 7</a> for important security considerations regarding claims gathering.)</p></div></div></div></div><div id="need-info"><h3 id="rfc.section.3.6"><a href="#rfc.section.3.6">3.6</a> <a href="#need-info">Client Responds to Authorization Server's Request for Additional Information</a></h3><div id="rfc.section.3.6.p.1"><p>If the client received a <tt>need_info</tt> error in response to its request for authorization, it has the opportunity to continue seeking authorization by engaging in follow-on flows with the authorization server, either directly or through redirection of an end-user requesting party. This process is sometimes known as "trust elevation".</p></div><div id="rfc.section.3.6.p.2"><p>If an <tt>error_details</tt> object was also returned with the error, then the contents of that object indicate the flow options.</p></div><div id="step-up"><h4 id="rfc.section.3.6.1"><a href="#rfc.section.3.6.1">3.6.1</a> <a href="#step-up">Client Redirects Requesting Party to Authorization Server for Authentication</a></h4><div id="rfc.section.3.6.1.p.1"><p>On receiving an <tt>authentication_context</tt> hint, the client has the option to redirect the requesting party to the authorization server to reauthenticate, as if for an AAT, in a manner anticipated to be more successful for gaining access. Such an action is sometimes referred to as "step-up" authentication.</p></div></div><div id="claim-push"><h4 id="rfc.section.3.6.2"><a href="#rfc.section.3.6.2">3.6.2</a> <a href="#claim-push">Client Pushes Claim Tokens to Authorization Server</a></h4><div id="rfc.section.3.6.2.p.1"><p>If the authorization server can accept pushed claims (for example, as it might have indicated by providing <tt>requesting_party_claims</tt> hints illustrated in <a href="#authorization-failure" title="Authorization Server Response to Client on Authorization Failure">Section 3.5.4</a>), the client has the option to <em>push</em> claim tokens to the RPT endpoint. The claim token can reflect the client's role as a federated identity provider, a federated relying party, or an application integrated with a native identity repository.</p></div><div id="rfc.section.3.6.2.p.2"><p>If the client is aware of the authorization server's requirements for claims through an out-of-band relationship, the client MAY push claim tokens in an initial interaction with the RPT endpoint.</p></div><div id="rfc.section.3.6.2.p.3"><p>The client supplies claim tokens in the body of the authorization data request message by providing, in addition to the <tt>rpt</tt> and <tt>ticket</tt> properties, the following property:</p><dl><dt>claim_tokens</dt><dd>REQUIRED. An array of objects with the following properties:<dl><dt>format</dt><dd>REQUIRED. A string specifying the format of the accompanying claim tokens. The string MAY be a URI.</dd><dt>token</dt><dd>REQUIRED. A string containing the claim information in the indicated format, base64url encoded if it is not already so encoded. If claim token format features are included that require special interpretation, the client and authorization server are assumed to have a prior relationship that establishes how to interpret these features. For example, if the referenced format equates to SAML 2.0 assertions and the claim token contains audience restrictions, it is the joint responsibility of the client and authorization server to determine the proper audience values that enable successful token consumption (see for <a href="#trust-push" title="Requirements for Trust When Clients Push Claim Tokens">Section 7.4.1</a> relevant security considerations).</dd></dl></dd></dl></div><div id="rfc.figure.u.15"><p>Example:</p><pre>POST /rpt_authorization HTTP/1.1
Host: www.example.com
Authorization: Bearer jwfLG53^sad$#f
...
{
    "rpt": "sbjsbhs(/SSJHBSUSSJHVhjsgvhsgvshgsv",
    "ticket": "016f84e8-f9b9-11e0-bd6f-0021cc6004de",
    "claim_tokens": [
      {
        "format":
"http://openid.net/specs/openid-connect-core-1_0.html#HybridIDToken",
        "token": "..."
      }
    ]
}
    </pre></div><div id="rfc.section.3.6.2.p.4"><p>This specification provides a framework for extensibility through claim token format profiling. The authorization server MAY support any number of claim token profiles, and SHOULD document the claim token profiles it supports in its configuration data.</p></div></div><div id="claim-redirect"><h4 id="rfc.section.3.6.3"><a href="#rfc.section.3.6.3">3.6.3</a> <a href="#claim-redirect">Client Redirects Requesting Party to Authorization Server for Claims-Gathering</a></h4><div id="rfc.section.3.6.3.p.1"><p>If the authorization server has declared a requesting party claims endpoint in its configuration data, or if the authorization server requires direct interaction with the requesting party as part of its claims-gathering process (for example, as it might have indicated through the <tt>redirect_user</tt> hint illustrated in <a href="#authorization-failure" title="Authorization Server Response to Client on Authorization Failure">Section 3.5.4</a>), the client has the option to <em>redirect</em> an end-user requesting party to the requesting party claims endpoint. In this case, the authorization server might be a relying party in a federated identity interaction, or it might connect to a directory or other user repository, or even interact with the user in other ways, such as presenting a questionnaire in a web form. After this process completes, the authorization server redirects the end-user requesting party back to the client.</p></div><div id="rfc.section.3.6.3.p.2"><p>The client constructs the request URI by adding the following parameters to the query component of the requesting party claims endpoint URI using the <tt>application/x-www-form-urlencoded</tt> format:</p><dl><dt>client_id</dt><dd>REQUIRED. The client's identifier issued by the authorization server.</dd><dt>claims_redirect_uri</dt><dd>OPTIONAL. The URI to which the client wishes the authorization server to direct the requesting party's user agent after completing its interaction. The URI MUST be absolute, MAY contain an <tt>application/x-www-form-urlencoded</tt>-formatted query parameter component that MUST be retained when adding additional parameters, and MUST NOT contain a fragment component. The authorization server SHOULD require all clients to register their redirection endpoint prior to utilizing the authorization endpoint (either using a static process or through <a href="#RFC7591"><cite title="OAuth 2.0 Dynamic Client Registration Protocol">[RFC7591]</cite></a> or <a href="#OIDCDynClientReg"><cite title="OpenID Connect Dynamic Client Registration 1.0 incorporating errata set 1">[OIDCDynClientReg]</cite></a>). The claims redirection URIs of a client MUST be registered distinct from the client's redirection URIs as used at the authorization endpoint during redirect-based OAuth flows. If the URI is pre-registered, this URI MUST exactly match one of the pre-registered claims redirection URIs, with the matching performed as described in Section 6.2.1 of <a href="#RFC3986"><cite title="Uniform Resource Identifier (URI): Generic Syntax">[RFC3986]</cite></a> (Simple String Comparison).</dd><dt>ticket</dt><dd>REQUIRED. The permission ticket associated with the client's current request for authorization data for this requesting party. The authorization server MUST return this parameter back to when the <tt>authorization_state</tt> is <tt>need_info</tt>.</dd><dt>state</dt><dd>OPTIONAL. An opaque value used by the client to maintain state between the request and callback. The authorization server includes this value when redirecting the user agent back to the client. The use of this parameter is RECOMMENDED for preventing cross-site request forgery.</dd></dl></div><div id="rfc.figure.u.16"><p>Example of a request issued by a client application (line breaks are shown only for display convenience):</p><pre>GET /rqp_claims?client_id=some_client_id&amp;state=abc
&amp;ticket=016f84e8-f9b9-11e0-bd6f-0021cc6004de
&amp;claims_redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fredirect_claims HTTP/1.1
Host: as.example.com</pre></div><div id="rfc.section.3.6.3.p.3"><p>At the conclusion of its interaction with the requesting party, the authorization server returns the user agent to the client adding the following parameters to the query component of the claims redirection URI using the <tt>application/x-www-form-urlencoded</tt> format:</p><dl><dt>authorization_state</dt><dd>REQUIRED. Indicates that the authorization server completed its claims-gathering interaction with the requesting party with the indicated state:<dl><dt>claims_submitted</dt><dd>The client is free to return to the RPT endpoint to seek authorization data once again.</dd><dt>not_authorized</dt><dd>The client is not authorized to have the desired authorization data added.</dd><dt>need_info</dt><dd>The authorization server needs additional information in order to determine whether the client is authorized to have this authorization data. This response directs the client to return to the RPT endpoint, where it might be provided with error_details hints about additional information needed.</dd><dt>request_submitted</dt><dd>The authorization server requires intervention by the resource owner to determine whether authorization data can be added. Further immediate interaction between the client, requesting party, and authorization server is out of scope of this specification.</dd></dl></dd><dt>ticket</dt><dd>OPTIONAL. The same permission ticket value that the client provided in the request. It MUST be present if and only if the authorization_state is need_info.</dd><dt>state</dt><dd>OPTIONAL. The same state value that the client provided in the request. It MUST be present if and only if the client provided it.</dd></dl></div><div id="rfc.section.3.6.3.p.4"><p>The client MUST ignore unrecognized response parameters. If the request fails due to a missing, invalid, or mismatching claims redirection URI, or if the client identifier is missing or invalid, the authorization server SHOULD inform the resource owner of the error and MUST NOT automatically redirect the user agent to the invalid redirection URI. If the request fails for reasons other than a missing or invalid claims redirection URI, the authorization server informs the client by adding an <tt>error</tt> parameter to the query component of the claims redirection URI using the <tt>application/x-www-form-urlencoded</tt> format, containing one of the following ASCII error codes:</p><dl><dt>invalid_request</dt><dd>The request is missing a required parameter, includes an invalid parameter value (such as an invalid or expired ticket), includes a parameter more than once, or is otherwise malformed.</dd><dt>server_error</dt><dd>The authorization server encountered an unexpected condition that prevented it from fulfilling the request. (This error code is needed because an HTTP 500 (Internal Server Error) status code cannot be returned to the client via an HTTP redirect.)</dd><dt>temporarily_unavailable</dt><dd>The authorization server is currently unable to handle the request due to a temporary overloading or maintenance of the server. (This error code is needed because an HTTP 503 (Service Unavailable) status code cannot be returned to the client via an HTTP redirect.)</dd></dl></div><div id="rfc.figure.u.17"><p>Example of a response issued by an authorization server (line breaks are shown only for display convenience):</p><pre>GET /redirect_claims?&amp;state=abc
&amp;authorization_state=claims_submitted HTTP/1.1
Host: client.example.com</pre></div></div></div></div><hr class="noprint"><div id="errors"><h2 id="rfc.section.4" class="np"><a href="#rfc.section.4">4.</a> <a href="#errors">Error Messages</a></h2><div id="rfc.section.4.p.1"><p>Both OAuth and UMA errors can occur.</p></div><div id="oauth-error-response"><h3 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1</a> <a href="#oauth-error-response">OAuth Error Responses</a></h3><div id="rfc.section.4.1.p.1"><p>As described in <a href="#protection-api" title="Protection API and Protection API Token">Section 1.3.1</a> and <a href="#authorization-api" title="Authorization API and Authorization API Token">Section 1.3.2</a>, the protection API requires a PAT for access, and the authorization API requires an AAT for access. PATs and AATs are simply OAuth access tokens with appropriate scope. If a request to an endpoint in one of these two APIs fails due to an invalid, missing, or expired access token, or requires higher privileges at this endpoint than provided by the token supplied, the authorization server responds with an OAuth error.</p></div></div><div id="uma-error-response"><h3 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2</a> <a href="#uma-error-response">UMA Error Responses</a></h3><div id="rfc.section.4.2.p.1"><p>If a request triggers no OAuth error, but is invalid for another reason as defined throughout this specification, the authorization server or resource server responds with an UMA error, sometimes along with a specified HTTP status code, by supplying the following properties in a JSON-encoded object in the body of the HTTP response: </p><dl><dt>error</dt><dd>REQUIRED. A single error code. Values for this property are defined throughout this specification.</dd><dt>error_description</dt><dd>OPTIONAL. Human-readable text providing additional information.</dd><dt>error_uri</dt><dd>OPTIONAL. A URI identifying a human-readable web page with information about the error.</dd></dl></div><div id="rfc.section.4.2.p.2"><p>The following is a common error code that applies to several UMA-specified request messages: </p><dl><dt>invalid_request</dt><dd>The request is missing a required parameter, includes an invalid parameter value, includes a parameter more than once, or is otherwise malformed. The authorization server MUST respond with the HTTP 400 (Bad Request) status code.</dd></dl></div><div id="rfc.figure.u.18"><p>For example:</p><pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
...

{
  "error": "invalid_request",
  "error_description": "Request is missing a required parameter.",
  "error_uri": "https://as.example.com/errors/bad_uma_request"
}
</pre></div></div></div><hr class="noprint"><div id="comms-profiles"><h2 id="rfc.section.5" class="np"><a href="#rfc.section.5">5.</a> <a href="#comms-profiles">Profiles for API Extensibility</a></h2><div id="rfc.section.5.p.1"><p>In some circumstances, it may be desirable to couple UMA software entity roles tightly. For example, an authorization server application might also need to act as a client application in order to retrieve protected resources so that it can present to resource owners a dashboard-like user interface that accurately guides the setting of policy; it might need to access itself-as-authorization server for that purpose. For another example, the same organization might operate both an authorization server and a resource server that communicate only with each other behind a firewall, and it might seek more efficient communication methods between them.</p></div><div id="rfc.section.5.p.2"><p>In other circumstances, it may be desirable to bind UMA flows to transport mechanisms other than HTTP even if entities remain loosely coupled. For example, in Internet of Things scenarios, Constrained Application Protocol (CoAP) may be preferred over HTTP.</p></div><div id="rfc.section.5.p.3"><p>This section defines profiles that allow inter-role communications channels and methods to vary in these circumstances. This specification still REQUIRES authorization servers to issue PATs, AATs, and RPTs and associate authorization data with RPTs, and REQUIRES resource servers not to give access in the case of an invalid RPT or an RPT associated with insufficient authorization. This is because, although tokens might not always appear on the wire in the normal fashion, the tokens may represent sets of expected behaviors of additional parties unable to take part in these optimization opportunities.</p></div><div id="rfc.section.5.p.4"><p>Where alternate communications channels are being used between independently implemented system entities, it is RECOMMENDED, for reasons of implementation interoperability, to define concrete extension profiles that build on these extensibility profiles (see <a href="#uma-profiles" title="Specifying Profiles of UMA">Section 6.1</a>).</p></div><div id="alt-prot-profile"><h3 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1</a> <a href="#alt-prot-profile">Protection API Extensibility Profile</a></h3><div id="rfc.section.5.1.p.1"><p>This section defines a profile for UMA where the authorization server and resource server roles either reside in the same system entity or otherwise have a privileged or specialized communications channel between them. Following is a summary:</p><ul><li>Identifying URI: https://docs.kantarainitiative.org/uma/profiles/prot-ext-1.0</li><li>Profile author and contact information: Mark Dobrinic (mdobrinic@cozmanova.com)</li><li>Updates or obsoletes: None; this profile is new.</li><li>Security considerations: See below.</li><li>Privacy considerations: See below.</li><li>Error states: None additional.</li></ul></div><div id="rfc.section.5.1.p.2"><p>Using this profile, the resource server MAY use means other than the HTTP-based protection API that is protected by TLS and OAuth (or an OAuth-based authentication protocol) to communicate with the authorization server in all respects, including using software interfaces and methods rather than network interfaces and APIs. The authorization server MUST still issue PATs, AATs, and RPTs and associate authorization data with RPTs, and the resource server still MUST NOT give clients access in the case of invalid RPTs or RPTs that are associated with insufficient authorization data. Interactions with entities other than the authorization server or resource server MUST be preserved exactly as they would have if either of them were using standardized UMA APIs, unless other extensibility profiles are also in use.</p></div><div id="rfc.section.5.1.p.3"><p>An authorization server using any of the opportunities afforded by this profile MUST declare use of this profile by supplying its identifying URI for one of its <tt>uma_profiles_supported</tt> values in its configuration data (see <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a>).</p></div><div id="rfc.section.5.1.p.4"><p>Same-entity communication or a tight integration of entities has the opportunity to make deployments more secure by reducing possible attack vectors. However, if the entities do not use TLS but communicate across a transport layer, it is RECOMMENDED to use an alternate means of transport-layer security, for example, using DTLS in the case of a CoAP-based UMA profile.</p></div><div id="rfc.section.5.1.p.5"><p>Same-entity communication or a tight integration of entities has the potential to compromise privacy by promoting the freer exchange of personal information within a deployment ecosystem. It is RECOMMENDED to account for privacy impacts in each deployment scenario.</p></div></div><div id="alt-authz-profile"><h3 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2</a> <a href="#alt-authz-profile">Authorization API Extensibility Profile</a></h3><div id="rfc.section.5.2.p.1"><p>This section defines a profile for UMA where the authorization server and client roles either reside in the same system entity or otherwise have a privileged or specialized communications channel between them. Following is a summary:</p><ul><li>Identifying URI: https://docs.kantarainitiative.org/uma/profiles/authz-ext-1.0</li><li>Profile author and contact information: Mark Dobrinic (mdobrinic@cozmanova.com)</li><li>Updates or obsoletes: None; this profile is new.</li><li>Security considerations: See below.</li><li>Privacy considerations: See below.</li><li>Error states: None additional.</li></ul></div><div id="rfc.section.5.2.p.2"><p>Using this profile, the client MAY use means other than the HTTP-based authorization API that is protected by TLS and OAuth (or an OAuth-based authentication protocol) to communicate with the authorization server in all respects, including using software interfaces and methods rather than network interfaces and APIs. The authorization server MUST still issue PATs, AATs, and RPTs and associate authorization data with RPTs, and the resource server still MUST NOT give clients access in the case of invalid RPTs or RPTs that are associated with insufficient authorization data. Interactions with entities other than the authorization server or client MUST be preserved exactly as they would have if either of them were using standardized UMA APIs, unless other extensibility profiles are also in use.</p></div><div id="rfc.section.5.2.p.3"><p>An authorization server using any of the opportunities afforded by this profile MUST declare use of this profile by supplying its identifying URI for one of its <tt>uma_profiles_supported</tt> values in its configuration data (see <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a>).</p></div><div id="rfc.section.5.2.p.4"><p>Same-entity communication or a tight integration of entities has the opportunity to make deployments more secure by reducing possible attack vectors. However, if the entities do not use TLS but communicate across a transport layer, it is RECOMMENDED to use an alternate means of transport-layer security, for example, using DTLS in the case of a CoAP-based UMA profile.</p></div><div id="rfc.section.5.2.p.5"><p>Same-entity communication or a tight integration of entities has the potential to compromise privacy by promoting the freer exchange of personal information within a deployment ecosystem. It is RECOMMENDED to account for privacy impacts in each deployment scenario.</p></div></div><div id="alt-resource-profile"><h3 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3</a> <a href="#alt-resource-profile">Resource Interface Extensibility Profile</a></h3><div id="rfc.section.5.3.p.1"><p>This section defines a profile for UMA where the resource server and client roles either reside in the same system entity or otherwise have a privileged or specialized communications channel between them. Following is a summary:</p><ul><li>Identifying URI: https://docs.kantarainitiative.org/uma/profiles/rsrc-ext-1.0</li><li>Profile author and contact information: Mark Dobrinic (mdobrinic@cozmanova.com)</li><li>Updates or obsoletes: None; this profile is new.</li><li>Security considerations: See below.</li><li>Privacy considerations: See below.</li><li>Error states: None additional.</li></ul></div><div id="rfc.section.5.3.p.2"><p>Using this profile, the resource server MAY use means other than an HTTP-based resource interface to communicate with the authorization server in all respects, including using software interfaces and methods rather than network interfaces and APIs. The resource server still MUST NOT give clients access in the case of invalid RPTs or RPTs that are associated with insufficient authorization data. Interactions with entities other than the resource server or client MUST be preserved exactly as they would have if either of them were using standardized UMA APIs, unless other extensibility profiles are also in use.</p></div><div id="rfc.section.5.3.p.3"><p>An authorization server involved in deployments where resource servers and clients are known to be using opportunities afforded by the resource interface extensibility profile MAY declare use of this profile by supplying its identifying URI for one of its <tt>uma_profiles_supported</tt> values in its configuration data (see <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a>).</p></div><div id="rfc.section.5.3.p.4"><p>Same-entity communication or a tight integration of entities has the opportunity to make deployments more secure by reducing possible attack vectors. However, if the entities do not use TLS but communicate across a transport layer, it is RECOMMENDED to use an alternate means of transport-layer security, for example, using DTLS in the case of a CoAP-based UMA profile.</p></div><div id="rfc.section.5.3.p.5"><p>Same-entity communication or a tight integration of entities has the potential to compromise privacy by promoting the freer exchange of personal information within a deployment ecosystem. It is RECOMMENDED to account for privacy impacts in each deployment scenario.</p></div></div></div><hr class="noprint"><div id="profiles"><h2 id="rfc.section.6" class="np"><a href="#rfc.section.6">6.</a> <a href="#profiles">Specifying Additional Profiles</a></h2><div id="rfc.section.6.p.1"><p>This specification defines a protocol that has optional features. For implementation interoperability and to serve particular deployment scenarios, including sector-specific ones such as healthcare or e-government, third parties may want to define profiles of UMA that restrict these options.</p></div><div id="rfc.section.6.p.2"><p>Further, this specification creates extensibility points for RPT profiles and claim token profiles, and third parties may likewise want to define their own. Different RPT profiles could be used, for example, to change the dividing line between authorization server and resource server responsibilities in controlling access. Different claim token profiles could be used to customize sector-specific or population-specific (such as individual vs. employee) claim types that drive the types of policies resource owners could set.</p></div><div id="rfc.section.6.p.3"><p>It is not practical for this specification to standardize all desired profiles. However, to serve overall interoperability goals, this section provides guidelines for third parties that wish to specify UMA-related profiles. In all cases, it is RECOMMENDED that profiles document the following information:</p><ul><li>Specify a URI that uniquely identifies the profile.</li><li>Identify the responsible author and provide postal or electronic contact information.</li><li>Supply references to any previously defined profiles that the profile updates or obsoletes.</li><li>Define any additional or changed error states.</li><li>Specify any conformance and interoperability considerations.</li><li>Supply any security and privacy considerations additional to <a href="#sec-consid" title="Security Considerations">Section 7</a>.</li></ul></div><div id="uma-profiles"><h3 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1</a> <a href="#uma-profiles">Specifying Profiles of UMA</a></h3><div id="rfc.section.6.1.p.1" class="avoidbreakafter"><p>It is RECOMMENDED that profiles of UMA additionally document the following information:</p></div><div id="rfc.section.6.1.p.2"><ul><li>Specify the set of interactions between endpoint entities involved in the profile, calling out any restrictions on ordinary UMA operations and any extension properties used in message formats.</li></ul></div><div id="rfc.section.6.1.p.3"><p>See <a href="#comms-profiles" title="Profiles for API Extensibility">Section 5</a> for examples.</p></div></div><div id="rpt-profiles"><h3 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2</a> <a href="#rpt-profiles">Specifying RPT Profiles</a></h3><div id="rfc.section.6.2.p.1" class="avoidbreakafter"><p>It is RECOMMENDED that RPT profiles additionally document the following information:</p></div><div id="rfc.section.6.2.p.2"><ul><li>Specify the keyword to be used in HTTP Authorization headers with tokens conforming to this profile.</li><li>Specify the syntax and semantics of the data that the authorization server associates with the token.</li><li>Specify how the token data is associated with, contained within, and/or retrieved by means of, the on-the-wire token string.</li><li>Specify processing rules for token data.</li><li>Identify any restrictions on grant types to be used with the token profile.</li></ul></div><div id="rfc.section.6.2.p.3"><p>See <a href="#uma-bearer-token-profile" title="RPT Profile: Bearer">Section 3.4.2</a> for an example.</p></div></div><div id="claim-profiles"><h3 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3</a> <a href="#claim-profiles">Specifying Claim Token Format Profiles</a></h3><div id="rfc.section.6.3.p.1"><p>It is RECOMMENDED that claim token format profiles additionally document the following information:</p><ul><li>Specify any related or additional <tt>error_details</tt> hints.</li><li>Specify any constraints on the claim token format vs. a standard definition for it in a specification.</li><li>Specify any mutual interpretation details of claim token formats by authorization servers and clients.</li></ul></div></div></div><hr class="noprint"><div id="sec-consid"><h2 id="rfc.section.7" class="np"><a href="#rfc.section.7">7.</a> <a href="#sec-consid">Security Considerations</a></h2><div id="rfc.section.7.p.1"><p>As a profile of OAuth, this specification relies mainly on OAuth security mechanisms as well as transport-level encryption. Thus, implementers are strongly advised to read <a href="#BCP195"><cite title="Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)">[BCP195]</cite></a> and the security considerations in <a href="#RFC6749"><cite title="The OAuth 2.0 Authorization Framework">[RFC6749]</cite></a> (Section 10) and <a href="#RFC6750"><cite title="The OAuth 2.0 Authorization Framework: Bearer Token Usage">[RFC6750]</cite></a> (Section 5) along with the security considerations of any other OAuth token-defining specifications in use, along with the entire <a href="#RFC6819"><cite title="OAuth 2.0 Threat Model and Security Considerations">[RFC6819]</cite></a> specification, and apply the countermeasures described therein. As well, since this specification builds on <a href="#OAuth-resource-reg"><cite title="OAuth 2.0 Resource Set Registration">[OAuth-resource-reg]</cite></a>, implementers should also take into account the security considerations in that specification.</p></div><div id="rfc.section.7.p.2"><p>The following sections describe additional security considerations.</p></div><div id="redirect-threats"><h3 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1</a> <a href="#redirect-threats">Requesting Party Redirection and Impersonation Threats</a></h3><div id="rfc.section.7.1.p.1"><p>This section discusses threats related to UMA's nature as an protocol enabling autonomous (non-resource-owner) requesting parties to gain authorized access to sensitive resources, including through the process of claims-gathering redirection.</p></div><div id="rfc.section.7.1.p.2"><p>Like ordinary OAuth redirection, UMA redirection for the purpose of gathering claims from an end-user requesting party (described in <a href="#claim-redirect" title="Client Redirects Requesting Party to Authorization Server for Claims-Gathering">Section 3.6.3</a>) creates the potential for cross-site request forgery (CSRF) through an open redirect if the authorization server does not force the client to pre-register its claims redirection endpoint, and server-side artifact tampering if the client does not avail itself of the state parameter. The client SHOULD check that the ticket value returned by an authorization server after a claims redirect is completed has not been maliciously changed, for example by a man in the browser (MITB), by using the state parameter. (See <a href="#UMA-Impl"><cite title="UMA Implementer's Guide">[UMA-Impl]</cite></a> for advice on ways to accomplish this.) Sections 4.4.1.8, 4.4.2.5, and 5.3.5 of <a href="#RFC6819"><cite title="OAuth 2.0 Threat Model and Security Considerations">[RFC6819]</cite></a> are apropos for the UMA claims-gathering redirection flow as well.</p></div><div id="rfc.section.7.1.p.3"><p>When a client redirects an end-user requesting party to the requesting party claims endpoint, the client provides no a priori context to the authorization server about which user is appearing at the endpoint, other than implicitly through the permission ticket. Since the authorization server is free to gather any claims it wishes, the effect is to "late-bind" them to the permission ticket and the state string provided by the client, with the effect of enabling the authorization server not to trust client-asserted claims. This is a desirable result and reflects one reason why the authorization server might choose to demand use of the redirect flow over the push flow. However, the client has the opportunity to switch end-users -- say, enabling malicious end-user Carlos to impersonate the original end-user Bob who authorized the issuance of the AAT -- after the redirect completes and before it returns to the RPT endpoint to seek authorization data.</p></div><div id="rfc.section.7.1.p.4"><p>Another issue concerns the exposure of a <tt>Bearer</tt>-type RPT to an autonomous requesting party, which could maliciously pass the token to an unauthorized party.</p></div><div id="rfc.section.7.1.p.5"><p>To mitigate requesting-party switching and RPT exposure threats, consider the following strategies.</p><ul><li>Require that the requesting party legitimately represent the wielder of the bearer token on a legal or contractual level (for example, as discussed in <a href="#UMA-obligations"><cite title="Binding Obligations on UMA Participants">[UMA-obligations]</cite></a>). This solution does not reduce the risk from a technical perspective.</li><li>The authorization server, possibly with input from the resource owner, can implement tighter time-to-live strategies around the authorization data in RPTs. This is a classic approach with bearer tokens that helps to limit a malicious party's ability to intercept and use the bearer token. In the same vein, the authorization server could require claims to have a reasonable degree of freshness (which would require a custom claims profile).</li><li>A stronger strategy is to "elevate trust" in the requesting party by requiring a stronger authentication context, forcing step-up authentication by the requesting party at run time.</li><li>The strongest strategy is to disallow <tt>Bearer</tt>-type RPTs within the UMA profile being deployed, by providing or requiring an RPT profile that requires use of a holder-of-key approach. In this way, the wielder of the token must engage in a live session for proof-of-possession.</li></ul></div></div><div><h3 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2</a> Client Authentication</h3><div id="rfc.section.7.2.p.1"><p>Along with TLS, UMA requires OAuth, or any OAuth-based authentication protocol, as the security mechanism for its standardized APIs. The UMA resource server acts in the role of an OAuth client at the authorization server's protection API, and the UMA client acts in the role of an OAuth client at the authorization server's authorization API. While it is possible to use any profile of OAuth for this protection, it is RECOMMENDED for the authorization server to use OpenID Connect, and to use its mechanisms for stronger client authentication at the token endpoint, in order to strengthen the authentication of OAuth clients. Section 16 of <a href="#OIDCCore"><cite title="OpenID Connect Core 1.0 incorporating errata set 1">[OIDCCore]</cite></a> provides more information on OpenID Connect security considerations.</p></div><div id="rfc.section.7.2.p.2"><p>Clients using the OAuth implicit grant type carry particular vulnerabilities in OAuth, and OpenID Connect is of no help in this circumstance. UMA scenarios are vulnerable as well. For example, an "implicit client" might require the retrieval of AATs more frequently, for each browser on each platform. An attacker can initiate a spear phishing attack on the requesting party with a link to a malicious website, relying on the requesting party to authenticate to the authorization server through an email-based identity provider in order to receive the AAT. The site can impersonate the requesting party using the browser client's client ID in an OpenID Connect implicit request to the UMA authorization server. If the requesting party had previously given consent for an AAT to be issued, this attempt will likely succeed. The subsequently issued AAT and permission ticket for an attempted resource access could potentially be used for RPT retrieval and authorization data issuance.</p></div><div id="rfc.section.7.2.p.3"><p>A number of mitigation strategies are possible.</p><ul><li>The authorization server could penalize or disallow use of the implicit grant flow. This could be done at a variety of levels:<ul><li>Enabling resource owners to define policies controlling the use of such clients</li><li>Setting system-default policies controlling their use</li><li>Participating in mutual agreements with other parties that admit only suitably secure client applications to interact with service operators</li></ul></li><li>The authorization server could support dynamic client registration at the client instance level, such that each instance receives a unique client_id and secret. The client can then use the authorization code flow and have at least some form of client authentication. However, this is easier for a mobile app than for a browser-based HTML app.</li></ul></div></div><div><h3 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3</a> JSON Usage</h3><div id="rfc.section.7.3.p.1"><p>This specification defines a number of data formats based on <a href="#RFC7159"><cite title="The JavaScript Object Notation (JSON) Data Interchange Format">[RFC7159]</cite></a>. As a subset of the JavaScript scripting language, JSON data SHOULD be consumed through a process that does not dynamically execute it as code, to avoid malicious code execution. One way to achieve this is to use a JSON parser rather than the built-in JavaScript eval() function.</p></div></div><div id="trust-considerations"><h3 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4</a> <a href="#trust-considerations">Profiles and Trust Establishment</a></h3><div id="rfc.section.7.4.p.1"><p>Parties operating and using UMA software entities have opportunities to establish agreements about the parties' rights and responsibilities on a legal or contractual level, along with common interpretations of UMA constructs for consistent and expected software behavior. These agreements can be used to improve the parties' respective security postures, and written profiles are a key mechanism for conveying and enforcing these agreements. <a href="#profiles" title="Specifying Additional Profiles">Section 6</a> discusses profiling. <a href="#comms-profiles" title="Profiles for API Extensibility">Section 5</a> discusses profiling for extensibility.</p></div><div id="trust-push"><h4 id="rfc.section.7.4.1"><a href="#rfc.section.7.4.1">7.4.1</a> <a href="#trust-push">Requirements for Trust When Clients Push Claim Tokens</a></h4><div id="rfc.section.7.4.1.p.1"><p>In contrast to the threats discussed in <a href="#redirect-threats" title="Requesting Party Redirection and Impersonation Threats">Section 7.1</a>, regarding the requesting party redirection model for claims-gathering (see <a href="#claim-redirect" title="Client Redirects Requesting Party to Authorization Server for Claims-Gathering">Section 3.6.3</a>), this section discusses the threats surrounding the model for claims-gathering where the client is the direct source of claims (see <a href="#claim-push" title="Client Pushes Claim Tokens to Authorization Server">Section 3.6.2</a>).</p></div><div id="rfc.section.7.4.1.p.2"><p>Because claim tokens of any format typically contain audience restrictions and an authorization server would typically not be in the primary audience for a claim token held or generated by a client, it is RECOMMENDED to document how the client, authorization server, and any additional ecosystem entities and parties will establish a trust relationship and communicate any required keying material in a claim token format profile, as described in <a href="#profiles" title="Specifying Additional Profiles">Section 6</a> and <a href="#claim-profiles" title="Specifying Claim Token Format Profiles">Section 6.3</a>. Authorization servers are RECOMMENDED not to accept claim tokens pushed by untrusted clients and not to ignore audience restrictions found in claim tokens pushed by clients.</p></div><div id="rfc.section.7.4.1.p.3"><p>In the special circumstance when an authorization server is colocated with an OpenID Provider for the requesting parties within a deployment ecosystem, then it is able to act as an OpenID Relying Party for itself. This circumstance presents an opportunity for a technical optimization of the requirement for trust because the authorization server itself issued the client credentials for the client in question, and could reasonably be the singular <tt>aud</tt> value target in an OpenID Connect ID Token pushed by the client to the RPT endpoint.</p></div></div></div></div><hr class="noprint"><div id="priv-consid"><h2 id="rfc.section.8" class="np"><a href="#rfc.section.8">8.</a> <a href="#priv-consid">Privacy Considerations</a></h2><div id="rfc.section.8.p.1"><p>UMA has the following privacy considerations.</p></div><div><h3 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1</a> Resource Set Information at the Authorization Server</h3><div id="rfc.section.8.1.p.1"><p>The authorization server comes to be in possession of resource set information that may reveal information about the resource owner, which the authorization server's trust relationship with the resource server is assumed to accommodate. However, the client is a less-trusted party -- in fact, entirely untrustworthy until authorization data is associated with its RPT. The more information about a resource set that is registered, the more risk of privacy compromise there is through a less-trusted authorization server.</p></div></div><div><h3 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2</a> Requesting Party Information at the Authorization Server</h3><div id="rfc.section.8.2.p.1"><p>The primary privacy duty of UMA's design is to the resource owner. However, privacy considerations affect the requesting party as well. This can be seen in the issuance of an AAT, which represents the approval of a requesting party for a client to engage with an authorization server to perform tasks needed for obtaining authorization, possibly including pushing claim tokens. Claim tokens are likely to contain personally identifiable and possibly very sensitive information, and much like identity attributes exchanged during single sign-on, the process of claim token pushing will tend to be invisible to an end-user requesting party if they have not consciously acknowledged and authorized the possibility. A requesting party who provides claims to an authorization server once redirected there is less susceptible to privacy-destroying behavior.</p></div></div><div><h3 id="rfc.section.8.3"><a href="#rfc.section.8.3">8.3</a> Profiles and Trust Establishment</h3><div id="rfc.section.8.3.p.1"><p>Parties operating and using UMA software entities have opportunities to establish agreements about mutual rights, responsibilities, and common interpretations of UMA constructs for consistent and expected software behavior. These agreements can be used to improve the parties' respective privacy postures. See <a href="#trust-considerations" title="Profiles and Trust Establishment">Section 7.4</a> for more information. Additional considerations related to Privacy by Design concepts are discussed in <a href="#UMA-PbD"><cite title="Privacy by Design Implications of UMA">[UMA-PbD]</cite></a>.</p></div></div></div><hr class="noprint"><div id="IANA"><h2 id="rfc.section.9" class="np"><a href="#rfc.section.9">9.</a> <a href="#IANA">IANA Considerations</a></h2><div id="rfc.section.9.p.1"><p>This document makes the following requests of IANA.</p></div><div><h3 id="rfc.section.9.1"><a href="#rfc.section.9.1">9.1</a> JSON Web Token Claims Registration</h3><div id="rfc.section.9.1.p.1"><p>This specification registers the claim defined in <a href="#uma-bearer-token-profile" title="RPT Profile: Bearer">Section 3.4.2</a>.</p></div><div><h4 id="rfc.section.9.1.1"><a href="#rfc.section.9.1.1">9.1.1</a> Registry Contents</h4><div id="rfc.section.9.1.1.p.1"><ul><li>Claim name: permissions</li><li>Claim description: Array of objects, each describing a set of scoped, time-limitable entitlements to a resource set</li><li>Change controller: Kantara Initiative User-Managed Access Work Group - wg-uma@kantarainitiative.org</li><li>Specification document: <a href="#uma-bearer-token-profile" title="RPT Profile: Bearer">Section 3.4.2</a> in this document</li></ul></div></div></div><div><h3 id="rfc.section.9.2"><a href="#rfc.section.9.2">9.2</a> OAuth Token Introspection Response Registration</h3><div id="rfc.section.9.2.p.1"><p>This specification registers the claim defined in <a href="#uma-bearer-token-profile" title="RPT Profile: Bearer">Section 3.4.2</a>.</p></div><div><h4 id="rfc.section.9.2.1"><a href="#rfc.section.9.2.1">9.2.1</a> Registry Contents</h4><div id="rfc.section.9.2.1.p.1"><ul><li>Name: permissions</li><li>Description: Array of objects, each describing a set of scoped, time-limitable entitlements to a resource set</li><li>Change controller: Kantara Initiative User-Managed Access Work Group - wg-uma@kantarainitiative.org</li><li>Specification document: <a href="#uma-bearer-token-profile" title="RPT Profile: Bearer">Section 3.4.2</a> in this document</li></ul></div></div></div><div><h3 id="rfc.section.9.3"><a href="#rfc.section.9.3">9.3</a> Well-Known URI Registration</h3><div id="rfc.section.9.3.p.1"><p>This specification registers the well-known URI defined in <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a>.</p></div><div><h4 id="rfc.section.9.3.1"><a href="#rfc.section.9.3.1">9.3.1</a> Registry Contents</h4><div id="rfc.section.9.3.1.p.1"><ul><li>URI suffix: uma-configuration</li><li>Change controller: Kantara Initiative User-M anaged Access Work Group - wg-uma@kantarainitiative.org</li><li>Specification document: <a href="#am-endpoints" title="Authorization Server Configuration Data">Section 1.4</a> in this document</li></ul></div></div></div></div><hr class="noprint"><div id="Acknowledgments"><h2 id="rfc.section.10" class="np"><a href="#rfc.section.10">10.</a> <a href="#Acknowledgments">Acknowledgments</a></h2><div id="rfc.section.10.p.1"><p>The following people made significant text contributions to the specification:</p><ul><li>Paul C. Bryan, ForgeRock US, Inc. (former editor)</li><li>Mark Dobrinic, Cozmanova</li><li>George Fletcher, AOL</li><li>Lukasz Moren, Cloud Identity Ltd</li><li>Christian Scholz, COMlounge GmbH (former editor)</li><li>Mike Schwartz, Gluu</li><li>Jacek Szpot, Newcastle University</li><li>Justin Richer</li></ul></div><div id="rfc.section.10.p.2"><p>Additional contributors to this specification include the Kantara UMA Work Group participants, a list of whom can be found at <a href="#UMAnitarians"><cite title="UMA Participant Roster">[UMAnitarians]</cite></a>.</p></div></div><hr class="noprint"><h2 id="rfc.references" class="np"><a id="rfc.section.11" href="#rfc.section.11">11.</a> References</h2><h3 class="np" id="rfc.references.1"><a href="#rfc.section.11.1" id="rfc.section.11.1">11.1</a> Normative References</h3><table><tr><td class="reference"><b id="BCP195">[BCP195]</b></td><td class="top">Sheffer, Y., “<a href="https://tools.ietf.org/html/bcp195">Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)</a>”, May 2015, &lt;<a href="https://tools.ietf.org/html/bcp195">https://tools.ietf.org/html/bcp195</a>&gt;.</td></tr><tr><td class="reference"><b id="OAuth-resource-reg">[OAuth-resource-reg]</b></td><td class="top">Hardjono, T., “<a href="https://docs.kantarainitiative.org/uma/rec-oauth-resource-reg-v1_0_1.html">OAuth 2.0 Resource Set Registration</a>”, December 2015, &lt;<a href="https://docs.kantarainitiative.org/uma/rec-oauth-resource-reg-v1_0_1.html">https://docs.kantarainitiative.org/uma/rec-oauth-resource-reg-v1_0_1.html</a>&gt;.</td></tr><tr><td class="reference"><b id="OIDCCore">[OIDCCore]</b></td><td class="top">Sakimura, N., “<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0 incorporating errata set 1</a>”, November 2014, &lt;<a href="http://openid.net/specs/openid-connect-core-1_0.html">http://openid.net/specs/openid-connect-core-1_0.html</a>&gt;.</td></tr><tr><td class="reference"><b id="OIDCDynClientReg">[OIDCDynClientReg]</b></td><td class="top">Sakimura, N., “<a href="http://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration 1.0 incorporating errata set 1</a>”, November 2014, &lt;<a href="http://openid.net/specs/openid-connect-registration-1_0.html">http://openid.net/specs/openid-connect-registration-1_0.html</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC2119">[RFC2119]</b></td><td class="top">Bradner, S., “<a href="http://www.rfc-editor.org/info/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP 14, RFC 2119, <a href="http://dx.doi.org/10.17487/RFC2119">DOI 10.17487/RFC2119</a>, March 1997, &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC3986">[RFC3986]</b></td><td class="top">Berners-Lee, T., Fielding, R., and L. Masinter, “<a href="http://www.rfc-editor.org/info/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>”, STD 66, RFC 3986, <a href="http://dx.doi.org/10.17487/RFC3986">DOI 10.17487/RFC3986</a>, January 2005, &lt;<a href="http://www.rfc-editor.org/info/rfc3986">http://www.rfc-editor.org/info/rfc3986</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC6415">[RFC6415]</b></td><td class="top">Hammer-Lahav, E., Ed. and B. Cook, “<a href="http://www.rfc-editor.org/info/rfc6415">Web Host Metadata</a>”, RFC 6415, <a href="http://dx.doi.org/10.17487/RFC6415">DOI 10.17487/RFC6415</a>, October 2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6415">http://www.rfc-editor.org/info/rfc6415</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC6711">[RFC6711]</b></td><td class="top">Johansson, L., “<a href="http://www.rfc-editor.org/info/rfc6711">An IANA Registry for Level of Assurance (LoA) Profiles</a>”, RFC 6711, <a href="http://dx.doi.org/10.17487/RFC6711">DOI 10.17487/RFC6711</a>, August 2012, &lt;<a href="http://www.rfc-editor.org/info/rfc6711">http://www.rfc-editor.org/info/rfc6711</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC6749">[RFC6749]</b></td><td class="top">Hardt, D., Ed., “<a href="http://www.rfc-editor.org/info/rfc6749">The OAuth 2.0 Authorization Framework</a>”, RFC 6749, <a href="http://dx.doi.org/10.17487/RFC6749">DOI 10.17487/RFC6749</a>, October 2012, &lt;<a href="http://www.rfc-editor.org/info/rfc6749">http://www.rfc-editor.org/info/rfc6749</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC6750">[RFC6750]</b></td><td class="top">Jones, M. and D. Hardt, “<a href="http://www.rfc-editor.org/info/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>”, RFC 6750, <a href="http://dx.doi.org/10.17487/RFC6750">DOI 10.17487/RFC6750</a>, October 2012, &lt;<a href="http://www.rfc-editor.org/info/rfc6750">http://www.rfc-editor.org/info/rfc6750</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC6819">[RFC6819]</b></td><td class="top">Lodderstedt, T., Ed., McGloin, M., and P. Hunt, “<a href="http://www.rfc-editor.org/info/rfc6819">OAuth 2.0 Threat Model and Security Considerations</a>”, RFC 6819, <a href="http://dx.doi.org/10.17487/RFC6819">DOI 10.17487/RFC6819</a>, January 2013, &lt;<a href="http://www.rfc-editor.org/info/rfc6819">http://www.rfc-editor.org/info/rfc6819</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC7159">[RFC7159]</b></td><td class="top">Bray, T., Ed., “<a href="http://www.rfc-editor.org/info/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>”, RFC 7159, <a href="http://dx.doi.org/10.17487/RFC7159">DOI 10.17487/RFC7159</a>, March 2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7159">http://www.rfc-editor.org/info/rfc7159</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC7519">[RFC7519]</b></td><td class="top">Jones, M., Bradley, J., and N. Sakimura, “<a href="http://www.rfc-editor.org/info/rfc7519">JSON Web Token (JWT)</a>”, RFC 7519, <a href="http://dx.doi.org/10.17487/RFC7519">DOI 10.17487/RFC7519</a>, May 2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7519">http://www.rfc-editor.org/info/rfc7519</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC7591">[RFC7591]</b></td><td class="top">Richer, J., Ed., Jones, M., Bradley, J., Machulak, M., and P. Hunt, “<a href="http://www.rfc-editor.org/info/rfc7591">OAuth 2.0 Dynamic Client Registration Protocol</a>”, RFC 7591, <a href="http://dx.doi.org/10.17487/RFC7591">DOI 10.17487/RFC7591</a>, July 2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7591">http://www.rfc-editor.org/info/rfc7591</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC7662">[RFC7662]</b></td><td class="top">Richer, J., Ed., “<a href="http://www.rfc-editor.org/info/rfc7662">OAuth 2.0 Token Introspection</a>”, RFC 7662, <a href="http://dx.doi.org/10.17487/RFC7662">DOI 10.17487/RFC7662</a>, October 2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7662">http://www.rfc-editor.org/info/rfc7662</a>&gt;.</td></tr></table><h3 id="rfc.references.2"><a href="#rfc.section.11.2" id="rfc.section.11.2">11.2</a> Informative References</h3><table><tr><td class="reference"><b id="UMA-casestudies">[UMA-casestudies]</b></td><td class="top">Maler, E., “<a href="https://kantarainitiative.org/confluence/display/uma/Case+Studies">UMA Case Studies</a>”, 2015, &lt;<a href="https://kantarainitiative.org/confluence/display/uma/Case+Studies">https://kantarainitiative.org/confluence/display/uma/Case+Studies</a>&gt;.</td></tr><tr><td class="reference"><b id="UMA-Impl">[UMA-Impl]</b></td><td class="top">Maler, E., “<a href="https://kantarainitiative.org/confluence/display/uma/UMA+Implementer%27s+Guide">UMA Implementer's Guide</a>”, 2015, &lt;<a href="https://kantarainitiative.org/confluence/display/uma/UMA+Implementer%27s+Guide">https://kantarainitiative.org/confluence/display/uma/UMA+Implementer%27s+Guide</a>&gt;.</td></tr><tr><td class="reference"><b id="UMA-obligations">[UMA-obligations]</b></td><td class="top">Maler, E., “<a href="https://docs.kantarainitiative.org/uma/draft-uma-trust.html">Binding Obligations on UMA Participants</a>”, January 2013, &lt;<a href="https://docs.kantarainitiative.org/uma/draft-uma-trust.html">https://docs.kantarainitiative.org/uma/draft-uma-trust.html</a>&gt;.</td></tr><tr><td class="reference"><b id="UMA-PbD">[UMA-PbD]</b></td><td class="top">Maler, E., “<a href="https://kantarainitiative.org/confluence/display/uma/Privacy+by+Design+Implications+of+UMA">Privacy by Design Implications of UMA</a>”, December 2013, &lt;<a href="https://kantarainitiative.org/confluence/display/uma/Privacy+by+Design+Implications+of+UMA">https://kantarainitiative.org/confluence/display/uma/Privacy+by+Design+Implications+of+UMA</a>&gt;.</td></tr><tr><td class="reference"><b id="UMA-usecases">[UMA-usecases]</b></td><td class="top">Maler, E., “<a href="https://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases">UMA Scenarios and Use Cases</a>”, October 2010, &lt;<a href="https://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases">https://kantarainitiative.org/confluence/display/uma/UMA+Scenarios+and+Use+Cases</a>&gt;.</td></tr><tr><td class="reference"><b id="UMAnitarians">[UMAnitarians]</b></td><td class="top">Maler, E., “<a href="https://kantarainitiative.org/confluence/display/uma/Participant+Roster">UMA Participant Roster</a>”, 2015, &lt;<a href="https://kantarainitiative.org/confluence/display/uma/Participant+Roster">https://kantarainitiative.org/confluence/display/uma/Participant+Roster</a>&gt;.</td></tr></table><hr class="noprint"><div class="avoidbreakinside"><h2 id="rfc.authors" class="np"><a href="#rfc.authors">Authors' Addresses</a></h2><p><b>Thomas Hardjono</b>
      (editor)
    <br>MIT<br>EMail: <a href="mailto:hardjono@mit.edu">hardjono@mit.edu</a></p><p><b>Eve Maler</b><br>ForgeRock<br>EMail: <a href="mailto:eve.maler@forgerock.com">eve.maler@forgerock.com</a></p><p><b>Maciej Machulak</b><br>Synergetics<br>EMail: <a href="mailto:maciej@synergetics.be">maciej@synergetics.be</a></p><p><b>Domenico Catalano</b><br>Oracle<br>EMail: <a href="mailto:domenico.catalano@oracle.com">domenico.catalano@oracle.com</a></p></div></body></html>
