<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc PUBLIC "-//IETF//DTD RFC 2629//EN"
"http://xml.resource.org/authoring/rfc2629.dtd" [
<!ENTITY RFC2119 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC6749 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6749.xml">
<!ENTITY RFC7159 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7159.xml">
]>
<rfc category="std" docName="draft-uma-claims-ext" id="kantara" ipr="kantara"
     target="publicReview" version="1.0">
  <?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>

  <?rfc toc='yes' ?>

  <?rfc tocdepth='4' ?>

  <?rfc symrefs='yes' ?>

  <?rfc sortrefs='yes' ?>

  <?rfc compact='yes' ?>

  <?rfc subcompact='no' ?>

  <front>
    <title abbrev="uma-claims-sec-ext">UMA Claims-Gathering Extension for
    Enhanced Security</title>

    <author fullname="Maciej Machulak" initials="M." role="editor"
            surname="Machulak">
      <organization>Synergetics</organization>

      <address>
        <email>maciej@synergetics.be</email>
      </address>
    </author>

    <author fullname="Eve Maler" initials="E." surname="Maler">
      <organization>ForgeRock</organization>

      <address>
        <email>eve.maler@forgerock.com</email>
      </address>
    </author>

    <author fullname="Domenico Catalano" initials="D." surname="Catalano">
      <organization>Oracle</organization>

      <address>
        <email>domenico.catalano@oracle.com</email>
      </address>
    </author>

    <date day="15" month="March" year="2016" />

    <abstract>
      <t>User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how
      resource owners can control protected-resource access by clients
      operated by arbitrary requesting parties, where the resources reside on
      any number of resource servers, and where a centralized authorization
      server governs access based on resource owner policies. This extension
      to UMA V1.0 and V1.0.1 enhances security by providing an alternate
      requesting party claims endpoint that adds entropy to the UMA permission
      ticket to avoid a session fixation attack.</t>
    </abstract>
  </front>

  <middle>
    <section anchor="introduction" title="Introduction">
      <t>User-Managed Access is a profile of OAuth 2.0 <xref
      target="RFC6749" />. UMA defines how resource owners can control
      protected-resource access by clients operated by arbitrary requesting
      parties, where the resources reside on any number of resource servers,
      and where a centralized authorization server governs access based on
      resource owner policies. This extension to UMA V1.0 <xref
      target="UMA10" /> and UMA V1.0.1 <xref target="UMA101" /> enhances
      security by providing an alternate requesting party claims endpoint that
      adds entropy to the UMA permission ticket to avoid a session fixation
      attack.</t>

      <section title="Notational Conventions">
        <t>The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL NOT',
        'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY', and 'OPTIONAL' in this
        document are to be interpreted as described in <xref
        target="RFC2119" />.</t>

        <t>Unless otherwise noted, all protocol properties and values are case
        sensitive. JSON <xref target="RFC7159" /> data structures defined by
        this specification MAY contain extension properties that are not
        defined in this specification. Any entity receiving or retrieving a
        JSON data structure SHOULD ignore extension properties it is unable to
        understand. Extension names that are unprotected from collisions are
        outside the scope of this specification.</t>
      </section>

      <section anchor="summary"
               title="Extension Summary and Configuration Data">
        <t>Following is a summary of this extension and how its identifying
        URI is used.<list style="symbols">
            <t>Identifying URI: <spanx
            style="verb">https://docs.kantarainitiative.org/uma/extensions/claims-sec-1.0</spanx><list
                style="symbols">
                <t>An UMA V1.0 or V1.0.1 authorization server that supports
                this extension MUST provide this identifying URI in the <spanx
                style="verb">uma_profiles_supported</spanx> property in its
                configuration data.</t>
              </list></t>

            <t>Extension author and contact information: Maciej Machulak
            (maciej@synergetics.be).</t>

            <t>Updates or obsoletes: None; this extension is new.</t>

            <t>Security considerations: None additional. The topic of the
            extension is security.</t>

            <t>Privacy considerations: None additional.</t>

            <t>Error states: None additional.</t>
          </list></t>
      </section>
    </section>

    <section anchor="getting-authz-accessing-resource"
             title="Security Extension">
      <t>If the client redirects the requesting party end user to the
      requesting party claims endpoint at the authorization server, the UMA
      V1.0 and V1.0.1 specifications define that the authorization server must
      return the user agent to the client with, among other parameters, a
      <spanx style="verb">ticket</spanx> parameter whose value is the same as
      the permission ticket value the client sent to this authorization server
      earlier. The <spanx style="verb">ticket</spanx> parameter in the
      response from the authorization server is required only when the
      authorization server previously sent the client a <spanx
      style="verb">need_info</spanx> response. It is possible for the <spanx
      style="verb">need_info</spanx>/<spanx style="verb">ticket</spanx> cycle
      to repeat.</t>

      <t>A session fixation attack is possible when an attacker uses a client
      with the same client identifier as the legitimate client. The attacker phishes a
      a legitimate requesting party into completing a claims-gathering flow at
      the requesting party claims endpoint of the authorization server.
      Despite completing such claims-gathering flow, a client operated by a
      legitimate requesting party does not send a request for a requesting
      party token because the client acting on behalf of the legitimate
      requesting party did not initiate the flow
      of requesting access to a protected resource at a resource server.
      Instead, the attacker takes over and completes the original session with
      the permission ticket value that remains static throughout the
      transaction.</t>

      <t>The attack is possible because of a constant permission ticket value
      pointing to an authorization state at the authorization server when such
      authorization state can change (that is, initially the authorization
      state refers to the permission as registered by the resource server
      while after successful completion of the claims-gathering flow such
      state can refer to an authorized set ot permissions).</t>

      <t>To mitigate this attack, an authorization server that has indicated
      its conformance to this extension profile through the identifying URI
      indicated in <xref target="summary" /> MUST do the following:<list
          style="symbols">
          <t>Advertise an enhanced requesting party claims endpoint in its
          configuration data called <spanx
          style="verb">security_enhanced_claims_endpoint</spanx>, and use this
          endpoint exclusively for interacting with the end-user requesting
          party to gather claims.</t>

          <t>Every time it adds a <spanx style="verb">ticket</spanx> query
          parameter to the <spanx style="verb">claims_redirect_uri</spanx>
          after a claims-gathering flow at this endpoint, select a new
          securely random value for the permission ticket, and invalidate the
          permission ticket previously received from the client. (Compare with
          Section 3.4.1.2.2 in <xref target="UMA10" /> and Section 3.6.3 in
          <xref target="UMA101" />.) Effectively, when this extension is in
          effect, the requirement stated in Section 3.2.2 of <xref
          target="UMA101" /> as "Permission tickets MUST NOT be single-use" is
          nullfied, and the ticket, in both its front-channel and back-channel
          correlation roles, becomes a single-use nonce.</t>
        </list></t>

      <t>This extension does not change any original requirements of UMA if
      used without these enhancements.</t>

      <t>See <xref target="UMAsession" /> for background information on this
      attack and the provided mitigation.</t>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document makes no requests of IANA.</t>
    </section>

    <section anchor="Acknowledgments" title="Acknowledgments">
      <t>The following people made significant contributions to the Work
      Group's understanding of the attack (in alphabetical order):<list
          style="symbols">
          <t>Josh Mandel</t>

          <t>Justin Richer</t>

          <t>Sarah Squire</t>
        </list></t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <reference anchor="UMA10"
                 target="https://docs.kantarainitiative.org/uma/rec-uma-core-v1_0.html">
        <front>
          <title>User-Managed Access (UMA) Profile of OAuth 2.0, Version
          1.0</title>

          <author initials="T." surname="Hardjono">
            <organization>MIT</organization>
          </author>

          <date day="04" month="April" year="2015" />
        </front>
      </reference>

      <reference anchor="UMA101"
                 target="https://docs.kantarainitiative.org/uma/rec-uma-core-v1_0_1.html">
        <front>
          <title>User-Managed Access (UMA) Profile of OAuth 2.0, Version
          1.0.1</title>

          <author initials="T." surname="Hardjono">
            <organization>MIT</organization>
          </author>

          <date day="28" month="December" year="2015" />
        </front>
      </reference>

      &RFC2119;

      &RFC6749;

      &RFC7159;
    </references>

    <references title="Informative References">
      <reference anchor="UMAsession"
                 target="http://kantarainitiative.org/confluence/display/uma/Understanding+the+Session+Fixation+Attack+on+UMA+Claims-Gathering+and+the+Provided+Mitigation">
        <front>
          <title>Understanding the Session Fixation Attack on UMA
          Claims-Gathering and the Provided Mitigation</title>

          <author initials="E." surname="Maler">
            <organization>ForgeRock</organization>
          </author>

          <date day="27" month="February" year="2016" />
        </front>
      </reference>
    </references>
  </back>
</rfc>
